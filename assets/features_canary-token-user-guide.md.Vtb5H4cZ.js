import{_ as t,o as a,c as i,ah as s}from"./chunks/framework.504LQ1l3.js";const n="/assets/canary-dashboard-01.BaYMyqTt.png",r="/assets/canary-configure-01.DCpWQYWN.png",o="/assets/canary-testing-02.CtZ--6th.png",l="/assets/canary-testing-01.CUeK8Y25.png",h="/assets/canary-system-alert-01.BaIRu6cF.png",m=JSON.parse('{"title":"Canary Token Injection - User Guide","description":"","frontmatter":{},"headers":[],"relativePath":"features/canary-token-user-guide.md","filePath":"features/canary-token-user-guide.md"}'),d={name:"features/canary-token-user-guide.md"};function c(p,e,u,g,k,y){return a(),i("div",null,[...e[0]||(e[0]=[s('<h1 id="canary-token-injection-user-guide" tabindex="-1">Canary Token Injection - User Guide <a class="header-anchor" href="#canary-token-injection-user-guide" aria-label="Permalink to &quot;Canary Token Injection - User Guide&quot;">â€‹</a></h1><h2 id="what-is-canary-token-injection" tabindex="-1">What is Canary Token Injection? <a class="header-anchor" href="#what-is-canary-token-injection" aria-label="Permalink to &quot;What is Canary Token Injection?&quot;">â€‹</a></h2><p>Canary Token Injection is a security feature that helps detect when data from one user or session is accidentally exposed to another user. Think of it like a &quot;tripwire&quot; for an early warning system that alerts you to potential data leakage in your AI systems.</p><p><img src="'+n+`" alt="Canary Detection"></p><div class="danger custom-block"><p class="custom-block-title">This is a new feature we&#39;re experimenting with, so far so good, and feedback would be appreciated!</p></div><h3 id="the-problem-it-solves" tabindex="-1">The Problem It Solves <a class="header-anchor" href="#the-problem-it-solves" aria-label="Permalink to &quot;The Problem It Solves&quot;">â€‹</a></h3><p>Modern AI systems can sometimes leak data between users due to:</p><ul><li><strong>Prompt injection attacks</strong> that extract other users&#39; data</li><li><strong>Provider-side caching</strong> that mixes conversation contexts</li><li><strong>Shared memory or context</strong> across sessions</li><li><strong>RAG retrieval</strong> that surfaces inappropriate documents</li></ul><p>Canary tokens act as invisible tracking markers that help detect these leakage scenarios.</p><h2 id="how-it-works" tabindex="-1">How It Works <a class="header-anchor" href="#how-it-works" aria-label="Permalink to &quot;How It Works&quot;">â€‹</a></h2><ol><li><strong>Injection</strong>: When a request is processed, a small unique token is automatically embedded into the system prompt or context</li><li><strong>Tracking</strong>: The token is registered in the database along with who owns it</li><li><strong>Detection</strong>: When processing responses, the system looks for tokens that belong to other users</li><li><strong>Alerting</strong>: If a token from user A appears in user B&#39;s response, an alert is generated</li></ol><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>User A Request â†’ [Token &quot;abc12345&quot; injected] â†’ LLM Provider</span></span>
<span class="line"><span>                                                    â”‚</span></span>
<span class="line"><span>                                                    â–¼</span></span>
<span class="line"><span>User B Request â†’ Response contains &quot;abc12345&quot; â†’ ALERT!</span></span>
<span class="line"><span>                 (Cross-user leakage detected)</span></span></code></pre></div><h2 id="understanding-alerts" tabindex="-1">Understanding Alerts <a class="header-anchor" href="#understanding-alerts" aria-label="Permalink to &quot;Understanding Alerts&quot;">â€‹</a></h2><h3 id="alert-types" tabindex="-1">Alert Types <a class="header-anchor" href="#alert-types" aria-label="Permalink to &quot;Alert Types&quot;">â€‹</a></h3><table tabindex="0"><thead><tr><th>Type</th><th>Severity</th><th>What It Means</th></tr></thead><tbody><tr><td><strong>Cross-User</strong></td><td>ðŸ”´ Critical</td><td>User A&#39;s data appearing in User B&#39;s response</td></tr><tr><td><strong>Cross-Session</strong></td><td>ðŸŸ¡ Medium</td><td>Data from one session appearing in another session of the same user</td></tr><tr><td><strong>Stale Canary</strong></td><td>ðŸŸ  High</td><td>Very old token appearing (possible memorization by provider)</td></tr></tbody></table><h3 id="what-to-do-when-leakage-is-detected" tabindex="-1">What to Do When Leakage is Detected <a class="header-anchor" href="#what-to-do-when-leakage-is-detected" aria-label="Permalink to &quot;What to Do When Leakage is Detected&quot;">â€‹</a></h3><ol><li><strong>Don&#39;t Panic</strong>: A single alert may be a false positive</li><li><strong>Review Context</strong>: Check the leakage details <ul><li>Who owned the canary?</li><li>Where was it detected?</li><li>How old was the token?</li></ul></li><li><strong>Investigate Root Cause</strong>: <ul><li>Was this a shared context scenario?</li><li>Are users related/same organization?</li><li>Is this a known testing scenario?</li></ul></li><li><strong>Take Action</strong>: <ul><li>For confirmed leakage: Check LLM provider configuration</li><li>For repeated patterns: Consider stricter isolation</li></ul></li></ol><h2 id="configuration-options" tabindex="-1">Configuration Options <a class="header-anchor" href="#configuration-options" aria-label="Permalink to &quot;Configuration Options&quot;">â€‹</a></h2><p>Canary injection is <strong>disabled by default</strong>.</p><h3 id="basic-settings" tabindex="-1">Basic Settings <a class="header-anchor" href="#basic-settings" aria-label="Permalink to &quot;Basic Settings&quot;">â€‹</a></h3><table tabindex="0"><thead><tr><th>Setting</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>enabled</code></td><td><code>true</code></td><td>Turn canary injection on/off</td></tr><tr><td><code>injection_rate</code></td><td><code>1.0</code></td><td>Percentage of requests to inject (0.0 to 1.0)</td></tr><tr><td><code>retention_days</code></td><td><code>30</code></td><td>How long to keep canary records</td></tr></tbody></table><p><img src="`+r+`" alt="Canary Configuration"></p><h3 id="example-configurations" tabindex="-1">Example Configurations <a class="header-anchor" href="#example-configurations" aria-label="Permalink to &quot;Example Configurations&quot;">â€‹</a></h3><p><strong>Development Environment</strong> (full monitoring):</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;enabled&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;injection_rate&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;retention_days&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">7</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>Production Environment</strong> (balanced):</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;enabled&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;injection_rate&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;retention_days&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">30</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>High-Security Environment</strong>:</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;enabled&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;injection_rate&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;retention_days&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">90</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;survival_alert_threshold&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="monitoring-dashboard" tabindex="-1">Monitoring Dashboard <a class="header-anchor" href="#monitoring-dashboard" aria-label="Permalink to &quot;Monitoring Dashboard&quot;">â€‹</a></h2><h3 id="key-metrics-to-watch" tabindex="-1">Key Metrics to Watch <a class="header-anchor" href="#key-metrics-to-watch" aria-label="Permalink to &quot;Key Metrics to Watch&quot;">â€‹</a></h3><ol><li><strong>Injection Count</strong>: Total canaries injected over time</li><li><strong>Survival Rate</strong>: Percentage of canaries that successfully round-trip <ul><li>Low survival may indicate provider-side filtering</li></ul></li><li><strong>Leakage Count</strong>: Number of cross-boundary detections</li><li><strong>Leakage by Type</strong>: Breakdown of leakage categories</li></ol><h3 id="health-indicators" tabindex="-1">Health Indicators <a class="header-anchor" href="#health-indicators" aria-label="Permalink to &quot;Health Indicators&quot;">â€‹</a></h3><table tabindex="0"><thead><tr><th>Metric</th><th>Healthy</th><th>Warning</th><th>Critical</th></tr></thead><tbody><tr><td>Survival Rate</td><td>&gt;50%</td><td>20-50%</td><td>&lt;20%</td></tr><tr><td>Leakages/Day</td><td>0</td><td>1-2</td><td>&gt;2</td></tr><tr><td>Cross-User Leakages</td><td>0</td><td>-</td><td>Any</td></tr></tbody></table><h2 id="testing-your-setup" tabindex="-1">Testing Your Setup <a class="header-anchor" href="#testing-your-setup" aria-label="Permalink to &quot;Testing Your Setup&quot;">â€‹</a></h2><h3 id="verify-injection-is-working" tabindex="-1">Verify Injection is Working <a class="header-anchor" href="#verify-injection-is-working" aria-label="Permalink to &quot;Verify Injection is Working&quot;">â€‹</a></h3><ol><li>Create a test canary: <img src="`+o+'" alt="Canary Create Test"></li></ol><h3 id="simulate-leakage-detection" tabindex="-1">Simulate Leakage Detection <a class="header-anchor" href="#simulate-leakage-detection" aria-label="Permalink to &quot;Simulate Leakage Detection&quot;">â€‹</a></h3><p>Test detection by simulating a response containing another user&#39;s canary:</p><p><img src="'+l+'" alt="Canary Simulate"></p><p>System Alerts: <img src="'+h+'" alt="Canary System Alert"></p><h2 id="best-practices" tabindex="-1">Best Practices <a class="header-anchor" href="#best-practices" aria-label="Permalink to &quot;Best Practices&quot;">â€‹</a></h2><h3 id="_1-start-with-low-injection-rates" tabindex="-1">1. Start with Low Injection Rates <a class="header-anchor" href="#_1-start-with-low-injection-rates" aria-label="Permalink to &quot;1. Start with Low Injection Rates&quot;">â€‹</a></h3><p>Begin with 10% (<code>injection_rate: 0.1</code>) and increase as you verify the system is working correctly.</p><h3 id="_2-review-initial-alerts-carefully" tabindex="-1">2. Review Initial Alerts Carefully <a class="header-anchor" href="#_2-review-initial-alerts-carefully" aria-label="Permalink to &quot;2. Review Initial Alerts Carefully&quot;">â€‹</a></h3><p>The first few alerts may be false positives due to:</p><ul><li>Testing scenarios</li><li>Shared organizational contexts</li><li>Integration testing</li></ul><h3 id="_3-set-up-alerting" tabindex="-1">3. Set Up Alerting <a class="header-anchor" href="#_3-set-up-alerting" aria-label="Permalink to &quot;3. Set Up Alerting&quot;">â€‹</a></h3><p>Configure your monitoring system to alert on:</p><ul><li>Any cross-user leakage (immediate investigation required)</li><li>Sudden increases in any leakage type</li><li>Survival rate drops (may indicate provider issues)</li></ul><h3 id="_4-regular-maintenance" tabindex="-1">4. Regular Maintenance <a class="header-anchor" href="#_4-regular-maintenance" aria-label="Permalink to &quot;4. Regular Maintenance&quot;">â€‹</a></h3><ul><li>Review leakage reports weekly</li><li>Purge old canaries monthly (automatic with retention settings)</li><li>Verify injection is still working after provider updates</li></ul><h2 id="troubleshooting" tabindex="-1">Troubleshooting <a class="header-anchor" href="#troubleshooting" aria-label="Permalink to &quot;Troubleshooting&quot;">â€‹</a></h2><h3 id="canaries-not-being-injected" tabindex="-1">&quot;Canaries not being injected&quot; <a class="header-anchor" href="#canaries-not-being-injected" aria-label="Permalink to &quot;&quot;Canaries not being injected&quot;&quot;">â€‹</a></h3><p><strong>Check:</strong></p><ol><li>Is canary injection enabled?</li><li>What is the injection rate? (0 = no injection)</li><li>Is the proxy correctly configured with canary service?</li></ol><h3 id="high-false-positive-rate" tabindex="-1">&quot;High false positive rate&quot; <a class="header-anchor" href="#high-false-positive-rate" aria-label="Permalink to &quot;&quot;High false positive rate&quot;&quot;">â€‹</a></h3><p><strong>Possible causes:</strong></p><ul><li>Users sharing accounts across sessions</li><li>Testing with same user IDs</li><li>Integration tests not using isolated contexts</li></ul><p><strong>Solution:</strong></p><ul><li>Use unique user identifiers per actual user</li><li>Configure test environments with separate settings</li></ul><h3 id="low-survival-rate" tabindex="-1">&quot;Low survival rate&quot; <a class="header-anchor" href="#low-survival-rate" aria-label="Permalink to &quot;&quot;Low survival rate&quot;&quot;">â€‹</a></h3><p>This means injected canaries aren&#39;t appearing in responses.</p><p><strong>Possible causes:</strong></p><ul><li>LLM provider filtering/transforming content</li><li>Response truncation</li><li>Content safety filters</li></ul><p><strong>Solution:</strong></p><ul><li>Try different canary formats</li><li>Reduce system prompt size</li><li>Check provider documentation for filtering</li></ul><h3 id="unexpected-leakage-patterns" tabindex="-1">&quot;Unexpected leakage patterns&quot; <a class="header-anchor" href="#unexpected-leakage-patterns" aria-label="Permalink to &quot;&quot;Unexpected leakage patterns&quot;&quot;">â€‹</a></h3><p>Review the context:</p><ul><li>Are detected users in the same organization?</li><li>Are sessions related (e.g., same user, new browser)?</li><li>Is this expected data sharing?</li></ul><h2 id="privacy-considerations" tabindex="-1">Privacy Considerations <a class="header-anchor" href="#privacy-considerations" aria-label="Permalink to &quot;Privacy Considerations&quot;">â€‹</a></h2><ol><li><p><strong>Data Retention</strong>: Canary records include user session identifiers. Configure appropriate retention periods.</p></li><li><p><strong>Access Control</strong>: Limit access to leakage reports to security team members.</p></li><li><p><strong>Log Redaction</strong>: Consider redacting response snippets if they may contain sensitive data.</p></li></ol><h2 id="faq" tabindex="-1">FAQ <a class="header-anchor" href="#faq" aria-label="Permalink to &quot;FAQ&quot;">â€‹</a></h2><p><strong>Q: Does this affect response quality?</strong> A: No. Canary tokens are designed to be small (~3 tokens) and appear as system metadata that LLMs typically ignore.</p><p><strong>Q: Can users see the canary tokens?</strong> A: The tokens appear in the system prompt (not visible to end users) and may occasionally appear in raw API responses if not filtered.</p><p><strong>Q: What happens if a canary is detected?</strong> A: An alert is logged but the response is still delivered. This is by design - we prioritize availability over blocking on potential false positives.</p><p><strong>Q: How long should I keep canary records?</strong> A: 30 days is typical for most use cases. High-security environments may want 90+ days for forensic purposes.</p><p><strong>Q: Can this detect all data leakage?</strong> A: No. This is a sampling-based tripwire, not comprehensive DLP. It detects leakage patterns but cannot catch 100% of incidents.</p>',78)])])}const f=t(d,[["render",c]]);export{m as __pageData,f as default};
