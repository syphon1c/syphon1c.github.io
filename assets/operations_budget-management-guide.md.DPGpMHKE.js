import{_ as i,o as t,c as a,ah as e}from"./chunks/framework.504LQ1l3.js";const n="/assets/budget-main-view-01.B1Hrl5HE.png",k=JSON.parse('{"title":"Budget Management Guide","description":"","frontmatter":{},"headers":[],"relativePath":"operations/budget-management-guide.md","filePath":"operations/budget-management-guide.md"}'),l={name:"operations/budget-management-guide.md"};function r(o,s,h,p,g,d){return t(),a("div",null,[...s[0]||(s[0]=[e('<h1 id="budget-management-guide" tabindex="-1">Budget Management Guide <a class="header-anchor" href="#budget-management-guide" aria-label="Permalink to &quot;Budget Management Guide&quot;">​</a></h1><h2 id="budget-management-overview" tabindex="-1">Budget Management Overview <a class="header-anchor" href="#budget-management-overview" aria-label="Permalink to &quot;Budget Management Overview&quot;">​</a></h2><p>The AI Security Gateway provides comprehensive budget management features to control LLM API costs. Budget limits can be set at multiple levels (proxy, user, user group, organization) with automated enforcement, warning notifications, and detailed cost tracking.</p><p><img src="'+n+`" alt="Budget Management Dashboard"></p><h2 id="key-features" tabindex="-1">Key Features <a class="header-anchor" href="#key-features" aria-label="Permalink to &quot;Key Features&quot;">​</a></h2><ul><li><strong>Monthly Budgets</strong>: Set monthly spending limits with automatic reset</li><li><strong>Multi-Level Budgets</strong>: Configure budgets for proxies, users, user groups, and organization</li><li><strong>Warning Thresholds</strong>: Email notifications at 50%, 75%, 90%, and 100% usage</li><li><strong>Automatic Enforcement</strong>: Block requests when budget is exceeded</li><li><strong>Cost Attribution</strong>: Track costs per user, model, and proxy</li><li><strong>Real-Time Tracking</strong>: Monitor spending in real-time with WebSocket updates</li><li><strong>Budget Reset</strong>: Automatic monthly reset or manual reset on-demand</li><li><strong>Historical Reports</strong>: View budget usage trends and patterns</li></ul><hr><h2 id="budget-hierarchy" tabindex="-1">Budget Hierarchy <a class="header-anchor" href="#budget-hierarchy" aria-label="Permalink to &quot;Budget Hierarchy&quot;">​</a></h2><p>Budgets are enforced in a hierarchical order:</p><ol><li><strong>Organization Budget</strong> - Total spending limit for entire organization (Planned and still working on)</li><li><strong>User Group Budget</strong> - Spending limit for specific user groups (e.g., &quot;Engineering Team&quot;)</li><li><strong>User Budget</strong> - Individual user spending limit (Planned and still working on)</li><li><strong>Proxy Budget</strong> - Spending limit for specific LLM proxy (Planned and still working on)</li></ol><p><strong>Enforcement Logic</strong>: A request is allowed only if ALL applicable budgets have remaining quota. If any budget is exceeded, the request is blocked.</p><p><strong>Example</strong>:</p><ul><li>Organization budget: $10,000/month</li><li>Engineering team budget: $3,000/month</li><li>John Doe&#39;s user budget: $500/month</li><li>OpenAI proxy budget: $5,000/month</li></ul><p>When John (Engineering team) makes a request through the OpenAI proxy, ALL four budgets are checked. The request is blocked if ANY budget is exceeded.</p><hr><h2 id="budget-enforcement" tabindex="-1">Budget Enforcement <a class="header-anchor" href="#budget-enforcement" aria-label="Permalink to &quot;Budget Enforcement&quot;">​</a></h2><h3 id="how-budgets-are-enforced" tabindex="-1">How Budgets Are Enforced <a class="header-anchor" href="#how-budgets-are-enforced" aria-label="Permalink to &quot;How Budgets Are Enforced&quot;">​</a></h3><ol><li><strong>Pre-Request Check</strong>: Before proxying an LLM request, the Gateway checks all applicable budgets</li><li><strong>Budget Hierarchy</strong>: Organization → User Group → User → Proxy budgets are all checked</li><li><strong>Cost Estimation</strong>: Request is estimated based on model pricing (prompt tokens × input rate + completion tokens × output rate)</li><li><strong>Blocking Decision</strong>: If ANY budget would be exceeded, the request is blocked</li><li><strong>Usage Recording</strong>: Successful requests update all applicable budget usage counters</li></ol><h3 id="cost-calculation" tabindex="-1">Cost Calculation <a class="header-anchor" href="#cost-calculation" aria-label="Permalink to &quot;Cost Calculation&quot;">​</a></h3><p>The Gateway uses model-specific pricing to estimate costs:</p><table tabindex="0"><thead><tr><th>Model</th><th>Input (per 1M tokens)</th><th>Output (per 1M tokens)</th></tr></thead><tbody><tr><td>gpt-4o</td><td>$2.50</td><td>$10.00</td></tr><tr><td>gpt-4o-mini</td><td>$0.15</td><td>$0.60</td></tr><tr><td>gpt-4-turbo</td><td>$10.00</td><td>$30.00</td></tr><tr><td>claude-3-5-sonnet</td><td>$3.00</td><td>$15.00</td></tr><tr><td>claude-3-5-haiku</td><td>$0.80</td><td>$4.00</td></tr></tbody></table><p><strong>Custom Pricing</strong>: Add custom model pricing via <strong>Settings</strong> → <strong>System</strong> → <strong>Model Pricing</strong>.</p><h3 id="blocked-request-response" tabindex="-1">Blocked Request Response <a class="header-anchor" href="#blocked-request-response" aria-label="Permalink to &quot;Blocked Request Response&quot;">​</a></h3><p>When a budget is exceeded, the Gateway returns:</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Budget limit exceeded&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;budget_exceeded&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;code&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">429</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;details&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;budget_type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;user&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;budget_limit&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">500.00</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;current_usage&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">498.23</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;estimated_cost&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2.45</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;reset_date&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;2026-02-01T00:00:00Z&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><hr><h4 id="get-budget-status-via-api" tabindex="-1">Get Budget Status via API <a class="header-anchor" href="#get-budget-status-via-api" aria-label="Permalink to &quot;Get Budget Status via API&quot;">​</a></h4><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Get organization budget status</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -X</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> GET</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost:8080/api/v1/budgets/organization/status</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Authorization: Bearer YOUR_TOKEN&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Get user budget status</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -X</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> GET</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost:8080/api/v1/budgets/users/1/status</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Authorization: Bearer YOUR_TOKEN&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Get usage breakdown</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -X</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> GET</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost:8080/api/v1/budgets/organization/breakdown?period=this_month</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Authorization: Bearer YOUR_TOKEN&quot;</span></span></code></pre></div><hr><h2 id="budget-alerts" tabindex="-1">Budget Alerts <a class="header-anchor" href="#budget-alerts" aria-label="Permalink to &quot;Budget Alerts&quot;">​</a></h2><h3 id="warning-thresholds" tabindex="-1">Warning Thresholds <a class="header-anchor" href="#warning-thresholds" aria-label="Permalink to &quot;Warning Thresholds&quot;">​</a></h3><p>Budget warnings are sent when usage reaches configured thresholds:</p><ul><li><strong>50% Warning</strong>: Early notification to monitor usage</li><li><strong>75% Warning</strong>: Increased awareness of budget consumption</li><li><strong>90% Warning</strong>: Critical warning - budget nearly exhausted</li><li><strong>100% Alert</strong>: Budget exceeded - requests are now blocked</li></ul><h3 id="email-notifications-wip" tabindex="-1">Email Notifications (WIP) <a class="header-anchor" href="#email-notifications-wip" aria-label="Permalink to &quot;Email Notifications (WIP)&quot;">​</a></h3><p>Warning emails include:</p><ul><li><strong>Budget Type</strong>: Which budget reached threshold (org, user group, user, proxy)</li><li><strong>Current Usage</strong>: Total spending this month</li><li><strong>Remaining Budget</strong>: Amount remaining</li><li><strong>Threshold</strong>: Which threshold was reached (50%, 75%, 90%, 100%)</li><li><strong>Top Consumers</strong>: Users/models consuming the most budget</li><li><strong>Recommendations</strong>: Suggested actions to manage costs</li><li><strong>Reset Date</strong>: When budget will automatically reset</li></ul><p><strong>Example Email</strong>:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Subject: ⚠️ Budget Alert: 75% of Organization Budget Consumed</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Your organization has reached 75% of the monthly budget limit.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Budget Details:</span></span>
<span class="line"><span>- Monthly Limit: $10,000.00</span></span>
<span class="line"><span>- Current Usage: $7,523.45</span></span>
<span class="line"><span>- Remaining: $2,476.55</span></span>
<span class="line"><span>- Reset Date: 2026-02-01</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Top Consumers:</span></span>
<span class="line"><span>1. gpt-4o: $3,245.12 (43%)</span></span>
<span class="line"><span>2. claude-3-5-sonnet: $2,987.54 (40%)</span></span>
<span class="line"><span>3. gpt-4-turbo: $1,290.79 (17%)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Recommendations:</span></span>
<span class="line"><span>- Review high-cost model usage</span></span>
<span class="line"><span>- Consider switching to more cost-effective models</span></span>
<span class="line"><span>- Set user-level budgets to distribute costs</span></span>
<span class="line"><span></span></span>
<span class="line"><span>View Details: https://gateway.example.com/budgets</span></span></code></pre></div><h3 id="configuring-notifications" tabindex="-1">Configuring Notifications <a class="header-anchor" href="#configuring-notifications" aria-label="Permalink to &quot;Configuring Notifications&quot;">​</a></h3><ol><li>Navigate to <strong>Operations</strong> → <strong>Budget Management</strong></li><li>Select budget (organization, user group, user, or proxy)</li><li>Click <strong>Edit Budget</strong></li><li>Update <strong>Notification Emails</strong> field</li><li>Toggle warning thresholds (50%, 75%, 90%, 100%)</li><li>Click <strong>Save Budget</strong></li></ol><h2 id="budget-reset-wip" tabindex="-1">Budget Reset (WIP) <a class="header-anchor" href="#budget-reset-wip" aria-label="Permalink to &quot;Budget Reset (WIP)&quot;">​</a></h2><h3 id="automatic-monthly-reset" tabindex="-1">Automatic Monthly Reset <a class="header-anchor" href="#automatic-monthly-reset" aria-label="Permalink to &quot;Automatic Monthly Reset&quot;">​</a></h3><p>Budgets automatically reset on the first day of each month at 00:00 UTC.</p><p><strong>Reset Behavior</strong>:</p><ul><li><strong>Usage Counter</strong>: Reset to $0.00</li><li><strong>Budget Limit</strong>: Unchanged (carries over)</li><li><strong>Warning Thresholds</strong>: Re-enabled</li><li><strong>Blocked Requests</strong>: Automatically unblocked</li></ul><h3 id="manual-budget-reset" tabindex="-1">Manual Budget Reset <a class="header-anchor" href="#manual-budget-reset" aria-label="Permalink to &quot;Manual Budget Reset&quot;">​</a></h3><p>Administrators can manually reset budgets at any time.</p><h4 id="via-web-interface" tabindex="-1">Via Web Interface <a class="header-anchor" href="#via-web-interface" aria-label="Permalink to &quot;Via Web Interface&quot;">​</a></h4><ol><li>Navigate to <strong>Operations</strong> → <strong>Budget Management</strong></li><li>Select budget to reset</li><li>Click <strong>Reset Budget</strong> (⟲ icon)</li><li>Confirm reset</li><li>Budget usage immediately resets to $0.00</li></ol><h4 id="via-api" tabindex="-1">Via API <a class="header-anchor" href="#via-api" aria-label="Permalink to &quot;Via API&quot;">​</a></h4><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Reset organization budget</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -X</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> POST</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost:8080/api/v1/budgets/organization/reset</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Authorization: Bearer YOUR_TOKEN&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Reset user budget</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -X</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> POST</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost:8080/api/v1/budgets/users/1/reset</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Authorization: Bearer YOUR_TOKEN&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Reset all budgets (requires admin)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -X</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> POST</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost:8080/api/v1/budgets/reset-all</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Authorization: Bearer YOUR_TOKEN&quot;</span></span></code></pre></div><p><strong>Warning</strong>: Manual reset clears usage history for the current period. Use with caution.</p><hr><h2 id="budget-reports-wip-not-implemented-yet" tabindex="-1">Budget Reports (WIP - not implemented yet) <a class="header-anchor" href="#budget-reports-wip-not-implemented-yet" aria-label="Permalink to &quot;Budget Reports (WIP - not implemented yet)&quot;">​</a></h2><h3 id="generating-reports" tabindex="-1">Generating Reports <a class="header-anchor" href="#generating-reports" aria-label="Permalink to &quot;Generating Reports&quot;">​</a></h3><h4 id="generate-budget-report-via-web-interface" tabindex="-1">Generate Budget Report via Web Interface <a class="header-anchor" href="#generate-budget-report-via-web-interface" aria-label="Permalink to &quot;Generate Budget Report via Web Interface&quot;">​</a></h4><ol><li>Navigate to <strong>Operations</strong> → <strong>Budget Management</strong> → <strong>Reports</strong></li><li>Configure report parameters: <ul><li><strong>Report Type</strong>: Summary, Detailed, Cost Breakdown</li><li><strong>Time Period</strong>: This Month, Last Month, Last 90 Days, Custom</li><li><strong>Budget Scope</strong>: Organization, User Group, User, Proxy, All</li><li><strong>Format</strong>: PDF, CSV, JSON</li></ul></li><li>Click <strong>Generate Report</strong></li><li>Download report file</li></ol><h4 id="generate-budget-report-via-api" tabindex="-1">Generate Budget Report via API <a class="header-anchor" href="#generate-budget-report-via-api" aria-label="Permalink to &quot;Generate Budget Report via API&quot;">​</a></h4><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Generate monthly summary report</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -X</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> GET</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;http://localhost:8080/api/v1/budgets/reports/summary?period=this_month&amp;format=pdf&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Authorization: Bearer YOUR_TOKEN&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -o</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> budget-report.pdf</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Generate detailed cost breakdown (CSV)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -X</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> GET</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;http://localhost:8080/api/v1/budgets/reports/breakdown?period=last_month&amp;format=csv&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Authorization: Bearer YOUR_TOKEN&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -o</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> budget-breakdown.csv</span></span></code></pre></div><h3 id="report-contents" tabindex="-1">Report Contents <a class="header-anchor" href="#report-contents" aria-label="Permalink to &quot;Report Contents&quot;">​</a></h3><p><strong>Summary Report</strong> includes:</p><ul><li>Total spending for period</li><li>Budget utilization percentage</li><li>Cost breakdown by model</li><li>Cost breakdown by user</li><li>Cost breakdown by proxy</li><li>Top 10 most expensive requests</li><li>Budget alert history</li></ul><p><strong>Detailed Report</strong> includes all summary data plus:</p><ul><li>Individual request details</li><li>Token usage per request</li><li>Cost per request</li><li>User attribution</li><li>Timestamp and duration</li><li>Model and parameters used</li></ul><p><strong>Cost Breakdown Report</strong> includes:</p><ul><li>Hourly/daily/monthly aggregations</li><li>Cost trends and forecasts</li><li>Budget vs. actual spending</li><li>Efficiency metrics</li><li>Cost optimization recommendations</li></ul><hr><h2 id="budget-best-practices" tabindex="-1">Budget Best Practices <a class="header-anchor" href="#budget-best-practices" aria-label="Permalink to &quot;Budget Best Practices&quot;">​</a></h2><h3 id="setting-appropriate-limits" tabindex="-1">Setting Appropriate Limits <a class="header-anchor" href="#setting-appropriate-limits" aria-label="Permalink to &quot;Setting Appropriate Limits&quot;">​</a></h3><ol><li><strong>Start Conservative</strong>: Begin with lower budgets and increase as needed</li><li><strong>Monitor Usage</strong>: Review first month&#39;s usage to establish baseline</li><li><strong>Add Buffer</strong>: Set budgets 20-30% above expected usage</li><li><strong>Tiered Approach</strong>: Use hierarchy (org &gt; group &gt; user) for granular control</li></ol><h3 id="cost-optimization" tabindex="-1">Cost Optimization <a class="header-anchor" href="#cost-optimization" aria-label="Permalink to &quot;Cost Optimization&quot;">​</a></h3><ol><li><strong>Use Cost-Effective Models</strong>: Switch to mini/haiku models for simple tasks</li><li><strong>Implement Caching</strong>: Use semantic caching to reduce redundant requests</li><li><strong>Optimize Prompts</strong>: Reduce prompt length without sacrificing quality</li><li><strong>Set Max Tokens</strong>: Limit completion length to prevent runaway costs</li><li><strong>User Education</strong>: Train users on cost-conscious LLM usage</li></ol><h3 id="monitoring-and-alerts" tabindex="-1">Monitoring and Alerts <a class="header-anchor" href="#monitoring-and-alerts" aria-label="Permalink to &quot;Monitoring and Alerts&quot;">​</a></h3><ol><li><strong>Enable All Thresholds</strong>: Configure 50%, 75%, 90%, 100% alerts</li><li><strong>Multiple Recipients</strong>: Send alerts to team leads, finance, and admins</li><li><strong>Regular Reviews</strong>: Weekly review of top consumers</li><li><strong>Trend Analysis</strong>: Monitor month-over-month spending trends</li><li><strong>Anomaly Detection</strong>: Investigate sudden spending spikes</li></ol><hr><h2 id="budget-troubleshooting" tabindex="-1">Budget Troubleshooting <a class="header-anchor" href="#budget-troubleshooting" aria-label="Permalink to &quot;Budget Troubleshooting&quot;">​</a></h2><h3 id="budget-not-enforcing" tabindex="-1">Budget Not Enforcing <a class="header-anchor" href="#budget-not-enforcing" aria-label="Permalink to &quot;Budget Not Enforcing&quot;">​</a></h3><p><strong>Problem</strong>: Requests continue even after budget is exceeded.</p><p><strong>Solution</strong>:</p><ol><li>Verify budget is <strong>Enabled</strong> (toggle is ON)</li><li>Check <strong>Block at 100%</strong> is enabled</li><li>Confirm user/proxy is within budget scope</li><li>Review audit logs for budget check results:<div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -X</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> GET</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;http://localhost:8080/api/v1/audit/logs?event_type=budget_check&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Authorization: Bearer YOUR_TOKEN&quot;</span></span></code></pre></div></li><li>Verify model pricing is configured (missing pricing = $0 cost = no enforcement)</li></ol><h3 id="incorrect-cost-calculations" tabindex="-1">Incorrect Cost Calculations <a class="header-anchor" href="#incorrect-cost-calculations" aria-label="Permalink to &quot;Incorrect Cost Calculations&quot;">​</a></h3><p><strong>Problem</strong>: Reported costs don&#39;t match actual LLM provider bills.</p><p><strong>Solution</strong>:</p><ol><li>Verify model pricing is up-to-date: <strong>Settings</strong> → <strong>System</strong> → <strong>Model Pricing</strong></li><li>Check for custom models with missing pricing</li><li>Enable <strong>Langfuse Integration</strong> for accurate token tracking</li><li>Compare token counts with provider dashboard</li><li>Review request logs for discrepancies:<div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -X</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> GET</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;http://localhost:8080/api/v1/proxies/1/logs?include_tokens=true&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Authorization: Bearer YOUR_TOKEN&quot;</span></span></code></pre></div></li></ol><h3 id="missing-budget-alerts" tabindex="-1">Missing Budget Alerts <a class="header-anchor" href="#missing-budget-alerts" aria-label="Permalink to &quot;Missing Budget Alerts&quot;">​</a></h3><p><strong>Problem</strong>: Not receiving budget warning emails.</p><p><strong>Solution</strong>:</p><ol><li>Verify email integration is configured: <strong>Settings</strong> → <strong>Integrations</strong> → <strong>Email</strong></li><li>Test email with <strong>Send Test Email</strong> button</li><li>Check spam/junk folders</li><li>Verify notification emails are correct in budget configuration</li><li>Check budget warning thresholds are enabled</li><li>Review audit logs for email delivery status:<div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -X</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> GET</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;http://localhost:8080/api/v1/audit/logs?event_type=email_sent&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Authorization: Bearer YOUR_TOKEN&quot;</span></span></code></pre></div></li></ol><h3 id="budget-not-resetting" tabindex="-1">Budget Not Resetting <a class="header-anchor" href="#budget-not-resetting" aria-label="Permalink to &quot;Budget Not Resetting&quot;">​</a></h3><p><strong>Problem</strong>: Budget usage didn&#39;t reset on the first of the month.</p><p><strong>Solution</strong>:</p><ol><li>Verify Gateway was running at midnight UTC on the 1st</li><li>Check system logs for reset job execution:<div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">journalctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -u</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ai-security-gateway</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;budget reset&quot;</span></span></code></pre></div></li><li>Manually trigger reset via API:<div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -X</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> POST</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost:8080/api/v1/budgets/organization/reset</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Authorization: Bearer YOUR_TOKEN&quot;</span></span></code></pre></div></li><li>Check system timezone is set to UTC</li><li>Review cron job configuration if using systemd timer</li></ol><h3 id="hierarchical-budget-conflicts" tabindex="-1">Hierarchical Budget Conflicts <a class="header-anchor" href="#hierarchical-budget-conflicts" aria-label="Permalink to &quot;Hierarchical Budget Conflicts&quot;">​</a></h3><p><strong>Problem</strong>: Unable to determine which budget is blocking requests.</p><p><strong>Solution</strong>:</p><ol><li>Enable verbose logging: <strong>Settings</strong> → <strong>System</strong> → <strong>Log Level</strong> = Debug</li><li>Review request logs with budget check details:<div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -X</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> GET</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;http://localhost:8080/api/v1/proxies/1/logs?include_budget_check=true&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Authorization: Bearer YOUR_TOKEN&quot;</span></span></code></pre></div></li><li>Check budget status for all applicable levels: <ul><li>Organization: <code>/api/v1/budgets/organization/status</code></li><li>User Group: <code>/api/v1/budgets/user-groups/{id}/status</code></li><li>User: <code>/api/v1/budgets/users/{id}/status</code></li><li>Proxy: <code>/api/v1/budgets/proxies/{id}/status</code></li></ul></li><li>Look for the first budget with <code>remaining_budget &lt;= 0</code></li></ol><hr><h2 id="advanced-features" tabindex="-1">Advanced Features <a class="header-anchor" href="#advanced-features" aria-label="Permalink to &quot;Advanced Features&quot;">​</a></h2><h3 id="budget-forecasting" tabindex="-1">Budget Forecasting <a class="header-anchor" href="#budget-forecasting" aria-label="Permalink to &quot;Budget Forecasting&quot;">​</a></h3><p>The Gateway can forecast when budgets will be exceeded based on current usage trends.</p><h4 id="via-web-interface-1" tabindex="-1">Via Web Interface <a class="header-anchor" href="#via-web-interface-1" aria-label="Permalink to &quot;Via Web Interface&quot;">​</a></h4><ol><li>Navigate to <strong>Operations</strong> → <strong>Budget Management</strong> → <strong>Forecasting</strong></li><li>Select budget to forecast</li><li>View forecast chart showing: <ul><li>Current usage trend</li><li>Projected spending</li><li>Estimated exhaustion date</li><li>Recommended budget adjustments</li></ul></li><li>Configure alerts for projected overruns</li></ol><h4 id="get-budget-forecast-via-api" tabindex="-1">Get Budget Forecast via API <a class="header-anchor" href="#get-budget-forecast-via-api" aria-label="Permalink to &quot;Get Budget Forecast via API&quot;">​</a></h4><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -X</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> GET</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost:8080/api/v1/budgets/organization/forecast</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Authorization: Bearer YOUR_TOKEN&quot;</span></span></code></pre></div><p><strong>Response</strong>:</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;current_usage&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5234.12</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;budget_limit&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10000.00</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;days_remaining&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">18</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;projected_total&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">11245.67</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;projected_overrun&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1245.67</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;projected_exhaustion_date&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;2026-01-24T00:00:00Z&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;daily_average&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">290.78</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;recommendations&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;Current pace will exceed budget by $1,245.67&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;Consider increasing budget to $12,000/month&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;Reduce gpt-4-turbo usage by 30% to stay within budget&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="budget-sharing" tabindex="-1">Budget Sharing <a class="header-anchor" href="#budget-sharing" aria-label="Permalink to &quot;Budget Sharing&quot;">​</a></h3><p>Allow user groups to share a common budget pool.</p><ol><li>Navigate to <strong>Access Control</strong> → <strong>User Groups</strong></li><li>Select multiple user groups (Ctrl+Click or Cmd+Click)</li><li>Click <strong>Share Budget</strong></li><li>Configure shared budget: <ul><li><strong>Shared Limit</strong>: Total limit for all selected groups</li><li><strong>Allocation</strong>: Equal, Weighted, or Custom per group</li><li><strong>Overflow</strong>: Allow groups to borrow from others</li></ul></li><li>Click <strong>Create Shared Budget</strong></li></ol><h3 id="budget-rollover" tabindex="-1">Budget Rollover <a class="header-anchor" href="#budget-rollover" aria-label="Permalink to &quot;Budget Rollover&quot;">​</a></h3><p>Unused budget can roll over to the next month (up to a maximum).</p><ol><li>Navigate to <strong>Operations</strong> → <strong>Budget Management</strong> → <strong>Rollover Settings</strong></li><li>Enable <strong>Budget Rollover</strong></li><li>Configure: <ul><li><strong>Max Rollover</strong>: Maximum amount to carry over (e.g., 20% of monthly limit)</li><li><strong>Expiration</strong>: How long rollover credit lasts (1-12 months)</li></ul></li><li>Click <strong>Save Settings</strong></li></ol><p><strong>Example</strong>:</p><ul><li>Monthly budget: $10,000</li><li>Usage in January: $8,000</li><li>Rollover amount: $2,000 (capped at 20% = $2,000)</li><li>February budget: $10,000 + $2,000 = $12,000</li></ul><hr><h2 id="related-budget-documentation" tabindex="-1">Related Budget Documentation <a class="header-anchor" href="#related-budget-documentation" aria-label="Permalink to &quot;Related Budget Documentation&quot;">​</a></h2><ul><li><a href="./user-activity-guide.html">User Activity Guide</a> - Track user attribution and activity</li><li><a href="./../api-usage/token-usage.html">Token Usage Tracking</a> - Monitor LLM token consumption</li><li><a href="./../configuration/settings-guide.html">Settings Guide</a> - Configure email notifications and integrations</li><li><a href="./alert-recording-system.html">Alert Recording System</a> - Security alerts and notifications</li></ul>`,117)])])}const c=i(l,[["render",r]]);export{k as __pageData,c as default};
