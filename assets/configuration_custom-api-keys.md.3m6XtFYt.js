import{_ as a,o as i,c as e,ah as n}from"./chunks/framework.504LQ1l3.js";const t="/assets/custom-api-key-01.Bp2Zh2_G.png",u=JSON.parse('{"title":"Custom API Keys (Using Downstream Service Tokens)","description":"","frontmatter":{},"headers":[],"relativePath":"configuration/custom-api-keys.md","filePath":"configuration/custom-api-keys.md"}'),l={name:"configuration/custom-api-keys.md"};function o(h,s,p,k,r,d){return i(),e("div",null,[...s[0]||(s[0]=[n('<h1 id="custom-api-keys-using-downstream-service-tokens" tabindex="-1">Custom API Keys (Using Downstream Service Tokens) <a class="header-anchor" href="#custom-api-keys-using-downstream-service-tokens" aria-label="Permalink to &quot;Custom API Keys (Using Downstream Service Tokens)&quot;">​</a></h1><h2 id="custom-api-keys-overview" tabindex="-1">Custom API Keys Overview <a class="header-anchor" href="#custom-api-keys-overview" aria-label="Permalink to &quot;Custom API Keys Overview&quot;">​</a></h2><p>Instead of managing separate <code>uag_</code> API keys, you can now use your existing downstream service tokens (like LiteLLM&#39;s default <code>sk-</code> or Antropic&#39;s <code>sk-ant-api</code>tokens) directly as gateway authentication tokens. This eliminates the need for dual authentication and simplifies your Claude Code configuration.</p><h2 id="problem-this-solves" tabindex="-1">Problem This Solves <a class="header-anchor" href="#problem-this-solves" aria-label="Permalink to &quot;Problem This Solves&quot;">​</a></h2><p>Previously, you needed:</p><ol><li><strong>LiteLLM API key</strong> (<code>sk-STk......</code>) for the downstream service</li><li><strong>Gateway API key</strong> (<code>uag_xxx...</code>) for the gateway authentication</li><li><strong>HTTP proxy</strong> to inject the gateway API key header</li></ol><p>Now you can use just one key - your existing service token!</p><h2 id="custom-api-keys-how-it-works" tabindex="-1">Custom API Keys How It Works <a class="header-anchor" href="#custom-api-keys-how-it-works" aria-label="Permalink to &quot;Custom API Keys How It Works&quot;">​</a></h2><p>When creating an API key in the gateway, you can choose to:</p><p><strong>Option 1: Generate new key</strong> (default)</p><ul><li>Gateway generates a <code>uag_</code> prefixed key</li><li>You use this key in the <code>X-API-Key</code> header</li></ul><p><strong>Option 2: Use existing service token</strong> (new!)</p><ul><li>You provide your existing service token (e.g., <code>sk-STk......</code>)</li><li>Gateway stores a hash of this token</li><li>You continue using your existing <code>ANTHROPIC_AUTH_TOKEN</code></li><li>Gateway validates the token from the <code>Authorization: Bearer</code> header</li></ul><h2 id="creating-a-custom-api-key" tabindex="-1">Creating a Custom API Key <a class="header-anchor" href="#creating-a-custom-api-key" aria-label="Permalink to &quot;Creating a Custom API Key&quot;">​</a></h2><h3 id="custom-keys-via-web-ui" tabindex="-1">Custom Keys Via Web UI <a class="header-anchor" href="#custom-keys-via-web-ui" aria-label="Permalink to &quot;Custom Keys Via Web UI&quot;">​</a></h3><ol><li>Go to <strong>User Groups</strong> → View your group</li><li>Click <strong>+ Create API Key</strong></li><li>Enter a name (e.g., &quot;Claude Code Token&quot;)</li><li><strong>Check the box</strong>: ☑ &quot;Use existing service token (e.g., LiteLLM sk-xxx key)&quot;</li><li>Enter your service token: <code>sk-STk......</code></li><li>Click <strong>Create Key</strong></li></ol><p><img src="'+t+`" alt="Custom API"></p><p>The gateway will:</p><ul><li>Hash and store your service token securely</li><li>Return the token back to you (for confirmation)</li><li>Allow authentication using <code>Authorization: Bearer sk-xxx...</code></li></ul><h3 id="custom-keys-via-api" tabindex="-1">Custom Keys Via API <a class="header-anchor" href="#custom-keys-via-api" aria-label="Permalink to &quot;Custom Keys Via API&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -X</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> POST</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost:8080/api/v1/api-keys</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Content-Type: application/json&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Authorization: Bearer &lt;your-admin-token&gt;&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;name&quot;: &quot;Claude Code Token&quot;,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;user_group_id&quot;: 1,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;description&quot;: &quot;LiteLLM token for Claude Code&quot;,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;custom_key&quot;: &quot;sk-STk......&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  }&#39;</span></span></code></pre></div><p>Response:</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;success&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;api_key&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Claude Code Token&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;key_prefix&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sk-STkVM&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;user_group_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;active&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;created_at&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;2025-10-23T12:00:00Z&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;key&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sk-STk......&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;API key created successfully. Save this key securely - it will not be shown again!&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="claude-code-configuration" tabindex="-1">Claude Code Configuration <a class="header-anchor" href="#claude-code-configuration" aria-label="Permalink to &quot;Claude Code Configuration&quot;">​</a></h2><h3 id="before-with-proxy" tabindex="-1">Before (With Proxy) <a class="header-anchor" href="#before-with-proxy" aria-label="Permalink to &quot;Before (With Proxy)&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Needed separate proxy</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ANTHROPIC_BASE_URL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">http://localhost:8034/  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Proxy on 8034</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ANTHROPIC_AUTH_TOKEN</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sk-STk......&quot;</span></span></code></pre></div><h3 id="after-direct" tabindex="-1">After (Direct) <a class="header-anchor" href="#after-direct" aria-label="Permalink to &quot;After (Direct)&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Direct to gateway - no proxy needed!</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ANTHROPIC_BASE_URL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">http://localhost:8033/  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Gateway on 8033</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ANTHROPIC_AUTH_TOKEN</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sk-STk......&quot;</span></span></code></pre></div><p>That&#39;s it! No extra proxy needed.</p><h2 id="how-authentication-works" tabindex="-1">How Authentication Works <a class="header-anchor" href="#how-authentication-works" aria-label="Permalink to &quot;How Authentication Works&quot;">​</a></h2><h3 id="header-extraction-priority" tabindex="-1">Header Extraction Priority <a class="header-anchor" href="#header-extraction-priority" aria-label="Permalink to &quot;Header Extraction Priority&quot;">​</a></h3><p>The gateway checks headers in this order:</p><ol><li><p><strong><code>X-API-Key</code> header</strong> (checked first)</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>X-API-Key: uag_abc123...</span></span></code></pre></div></li><li><p><strong><code>Authorization: Bearer</code> header</strong> (checked second)</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Authorization: Bearer sk-STk......</span></span></code></pre></div></li><li><p><strong><code>Authorization: ApiKey</code> header</strong> (checked third)</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Authorization: ApiKey uag_abc123...</span></span></code></pre></div></li></ol><p><strong>Only ONE token is extracted</strong> - whichever is found first.</p><h3 id="standard-gateway-key-uag" tabindex="-1">Standard Gateway Key (uag_) <a class="header-anchor" href="#standard-gateway-key-uag" aria-label="Permalink to &quot;Standard Gateway Key (uag_)&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Client Request:</span></span>
<span class="line"><span>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</span></span>
<span class="line"><span>X-API-Key: uag_abc123def456...</span></span>
<span class="line"><span>Authorization: Bearer sk-litellm-token  ← For downstream service</span></span>
<span class="line"><span>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Gateway Processing:</span></span>
<span class="line"><span>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</span></span>
<span class="line"><span>1. Extract: X-API-Key found → &quot;uag_abc123def456...&quot;</span></span>
<span class="line"><span>2. Hash: sha256(&quot;uag_abc123def456...&quot;) → &quot;hash_xyz...&quot;</span></span>
<span class="line"><span>3. Lookup: api_keys WHERE key_hash = &quot;hash_xyz...&quot;</span></span>
<span class="line"><span>4. Validate: Active? User group active? Has proxy access?</span></span>
<span class="line"><span>5. Forward to LiteLLM with both headers preserved:</span></span>
<span class="line"><span>   - X-API-Key: uag_abc123def456...</span></span>
<span class="line"><span>   - Authorization: Bearer sk-litellm-token</span></span>
<span class="line"><span>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</span></span></code></pre></div><h3 id="custom-service-token-sk-new" tabindex="-1">Custom Service Token (sk-) - NEW! <a class="header-anchor" href="#custom-service-token-sk-new" aria-label="Permalink to &quot;Custom Service Token (sk-) - NEW!&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Client Request (Claude Code):</span></span>
<span class="line"><span>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</span></span>
<span class="line"><span>Authorization: Bearer sk-STk......</span></span>
<span class="line"><span>Content-Type: application/json</span></span>
<span class="line"><span>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Gateway Processing:</span></span>
<span class="line"><span>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</span></span>
<span class="line"><span>1. Extract: X-API-Key not found</span></span>
<span class="line"><span>2. Extract: Authorization Bearer found → &quot;sk-STk......&quot;</span></span>
<span class="line"><span>3. Hash: sha256(&quot;sk-STk......&quot;) → &quot;hash_abc...&quot;</span></span>
<span class="line"><span>4. Lookup: api_keys WHERE key_hash = &quot;hash_abc...&quot;</span></span>
<span class="line"><span>5. Found! API Key registered as &quot;Claude Code Token&quot;</span></span>
<span class="line"><span>6. Validate: Active? User group active? Has proxy access?</span></span>
<span class="line"><span>7. Forward to LiteLLM with SAME Authorization header:</span></span>
<span class="line"><span>   - Authorization: Bearer sk-STk......</span></span>
<span class="line"><span>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</span></span>
<span class="line"><span></span></span>
<span class="line"><span>LiteLLM receives:</span></span>
<span class="line"><span>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</span></span>
<span class="line"><span>Authorization: Bearer sk-STk......  ← Same token!</span></span>
<span class="line"><span>Content-Type: application/json</span></span>
<span class="line"><span>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</span></span></code></pre></div><p><strong>Magic</strong>: The same token (<code>sk-STk......</code>) is used for:</p><ol><li><strong>Gateway authentication</strong> - Validates against database (hash lookup)</li><li><strong>LiteLLM authentication</strong> - Forwarded unchanged to service</li></ol><p>No dual tokens, no extra proxy, no header injection needed!</p><h2 id="custom-api-keys-security" tabindex="-1">Custom API Keys Security <a class="header-anchor" href="#custom-api-keys-security" aria-label="Permalink to &quot;Custom API Keys Security&quot;">​</a></h2><h3 id="custom-key-token-storage" tabindex="-1">Custom Key Token Storage <a class="header-anchor" href="#custom-key-token-storage" aria-label="Permalink to &quot;Custom Key Token Storage&quot;">​</a></h3><ul><li><strong>Never stored in plain text</strong></li><li><strong>SHA-256 hash</strong> stored in database</li><li><strong>Same security</strong> as standard <code>uag_</code> keys</li><li><strong>Cannot be retrieved</strong> after creation (only hash is stored)</li></ul><h3 id="token-validation" tabindex="-1">Token Validation <a class="header-anchor" href="#token-validation" aria-label="Permalink to &quot;Token Validation&quot;">​</a></h3><ol><li>Extract token from <code>Authorization: Bearer &lt;token&gt;</code></li><li>Hash the token with SHA-256</li><li>Look up hash in <code>api_keys</code> table</li><li>Validate: <ul><li>Key is active</li><li>Key hasn&#39;t expired</li><li>User group is active</li><li>User group has proxy access</li></ul></li><li>Allow or deny request</li></ol><h3 id="token-display" tabindex="-1">Token Display <a class="header-anchor" href="#token-display" aria-label="Permalink to &quot;Token Display&quot;">​</a></h3><ul><li><strong>Prefix shown</strong>: <code>sk-STkVM</code> (first 8 characters)</li><li><strong>Full token</strong>: Only shown once at creation</li><li><strong>Masked in UI</strong>: <code>sk-STkVM••••••••</code></li></ul><h2 id="custom-api-keys-use-cases" tabindex="-1">Custom API Keys Use Cases <a class="header-anchor" href="#custom-api-keys-use-cases" aria-label="Permalink to &quot;Custom API Keys Use Cases&quot;">​</a></h2><h3 id="_1-claude-code-with-litellm" tabindex="-1">1. Claude Code with LiteLLM <a class="header-anchor" href="#_1-claude-code-with-litellm" aria-label="Permalink to &quot;1. Claude Code with LiteLLM&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1. Create API key with your LiteLLM token via UI</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2. Configure Claude Code</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ANTHROPIC_BASE_URL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">http://localhost:8033/</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ANTHROPIC_AUTH_TOKEN</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sk-STk......&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ANTHROPIC_MODEL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;custom--us.anthropic.claude-sonnet-4-5-20250929-v1&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 3. Use Claude Code normally - authentication handled automatically!</span></span></code></pre></div><h3 id="_2-multiple-environments-with-same-token" tabindex="-1">2. Multiple Environments with Same Token <a class="header-anchor" href="#_2-multiple-environments-with-same-token" aria-label="Permalink to &quot;2. Multiple Environments with Same Token&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Development</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># User Group: Development Team</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Custom Key: sk-dev-token-123</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Production</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># User Group: Production Team</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Custom Key: sk-prod-token-456</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Same token format, different user groups = different proxy access</span></span></code></pre></div><h3 id="_3-team-based-access-control" tabindex="-1">3. Team-Based Access Control <a class="header-anchor" href="#_3-team-based-access-control" aria-label="Permalink to &quot;3. Team-Based Access Control&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Team A has access to: OpenAI Proxy, custom-LiteLLM</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Team A uses: sk-team-a-token</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Team B has access to: DeepWiki MCP, Test MCP</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Team B uses: sk-team-b-token</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Same interface, different access rights</span></span></code></pre></div><h2 id="advantages" tabindex="-1">Advantages <a class="header-anchor" href="#advantages" aria-label="Permalink to &quot;Advantages&quot;">​</a></h2><h3 id="✅-simplified-configuration" tabindex="-1">✅ Simplified Configuration <a class="header-anchor" href="#✅-simplified-configuration" aria-label="Permalink to &quot;✅ Simplified Configuration&quot;">​</a></h3><ul><li><strong>No extra proxy needed</strong></li><li><strong>One token to manage</strong></li><li><strong>No header injection</strong></li><li><strong>Direct connection</strong></li></ul><h3 id="✅-backward-compatible" tabindex="-1">✅ Backward Compatible <a class="header-anchor" href="#✅-backward-compatible" aria-label="Permalink to &quot;✅ Backward Compatible&quot;">​</a></h3><ul><li><strong>Existing <code>uag_</code> keys still work</strong></li><li><strong>No breaking changes</strong></li><li><strong>Optional feature</strong></li><li><strong>Mix and match</strong> key types</li></ul><h3 id="✅-same-security" tabindex="-1">✅ Same Security <a class="header-anchor" href="#✅-same-security" aria-label="Permalink to &quot;✅ Same Security&quot;">​</a></h3><ul><li><strong>SHA-256 hashing</strong></li><li><strong>Same validation flow</strong></li><li><strong>Same access control</strong></li><li><strong>Same audit trail</strong></li></ul><h3 id="✅-better-ux" tabindex="-1">✅ Better UX <a class="header-anchor" href="#✅-better-ux" aria-label="Permalink to &quot;✅ Better UX&quot;">​</a></h3><ul><li><strong>Familiar token format</strong> (sk-, api-, etc.)</li><li><strong>No dual authentication</strong></li><li><strong>Works with existing tools</strong></li><li><strong>Simpler troubleshooting</strong></li></ul><h2 id="limitations" tabindex="-1">Limitations <a class="header-anchor" href="#limitations" aria-label="Permalink to &quot;Limitations&quot;">​</a></h2><h3 id="cannot-modify-token" tabindex="-1">Cannot Modify Token <a class="header-anchor" href="#cannot-modify-token" aria-label="Permalink to &quot;Cannot Modify Token&quot;">​</a></h3><p>Once created, you cannot change the custom token value. You must:</p><ol><li>Revoke the old API key</li><li>Create a new API key with the new token</li></ol><h3 id="token-must-be-unique" tabindex="-1">Token Must Be Unique <a class="header-anchor" href="#token-must-be-unique" aria-label="Permalink to &quot;Token Must Be Unique&quot;">​</a></h3><ul><li>Each token can only be registered once</li><li>Attempting to register the same token twice will fail</li><li>This prevents token conflicts</li></ul><h3 id="still-hashed" tabindex="-1">Still Hashed <a class="header-anchor" href="#still-hashed" aria-label="Permalink to &quot;Still Hashed&quot;">​</a></h3><ul><li>The custom token is still hashed (SHA-256)</li><li>Cannot retrieve the original token after creation</li><li>Same security model as standard keys</li></ul><h2 id="custom-api-keys-api-reference" tabindex="-1">Custom API Keys API Reference <a class="header-anchor" href="#custom-api-keys-api-reference" aria-label="Permalink to &quot;Custom API Keys API Reference&quot;">​</a></h2><h3 id="create-api-key-with-custom-token" tabindex="-1">Create API Key with Custom Token <a class="header-anchor" href="#create-api-key-with-custom-token" aria-label="Permalink to &quot;Create API Key with Custom Token&quot;">​</a></h3><p><strong>Endpoint</strong>: <code>POST /api/v1/api-keys</code></p><p><strong>Request Body</strong>:</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;My Custom Token&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;user_group_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;description&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Optional description&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;custom_key&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sk-your-service-token-here&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;expires_in_days&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">90</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>Response</strong>:</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;success&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;api_key&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;My Custom Token&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;key_prefix&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sk-your-s&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;user_group_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;user_group_name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;My Team&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;description&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Optional description&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;active&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;expires_at&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;2026-01-21T12:00:00Z&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;is_expired&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;last_used_at&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;request_count&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;created_at&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;2025-10-23T12:00:00Z&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;updated_at&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;2025-10-23T12:00:00Z&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;key&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sk-your-service-token-here&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;API key created successfully. Save this key securely - it will not be shown again!&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="create-standard-api-key-no-custom-token" tabindex="-1">Create Standard API Key (No Custom Token) <a class="header-anchor" href="#create-standard-api-key-no-custom-token" aria-label="Permalink to &quot;Create Standard API Key (No Custom Token)&quot;">​</a></h3><p><strong>Request Body</strong>:</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;My Standard Key&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;user_group_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;description&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Generated key&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>Response</strong>:</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;success&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;api_key&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: { </span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;key&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;uag_abc123def456...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;API key created successfully...&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="custom-api-keys-testing" tabindex="-1">Custom API Keys Testing <a class="header-anchor" href="#custom-api-keys-testing" aria-label="Permalink to &quot;Custom API Keys Testing&quot;">​</a></h2><h3 id="_1-create-custom-api-key" tabindex="-1">1. Create Custom API Key <a class="header-anchor" href="#_1-create-custom-api-key" aria-label="Permalink to &quot;1. Create Custom API Key&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -X</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> POST</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost:8080/api/v1/api-keys</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Content-Type: application/json&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;name&quot;: &quot;Test Token&quot;,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;user_group_id&quot;: 1,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;custom_key&quot;: &quot;sk-test-123456&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  }&#39;</span></span></code></pre></div><h3 id="_2-test-authentication" tabindex="-1">2. Test Authentication <a class="header-anchor" href="#_2-test-authentication" aria-label="Permalink to &quot;2. Test Authentication&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Using custom token</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Authorization: Bearer sk-test-123456&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     http://localhost:8033/v1/models</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Should return 200 OK if user group has proxy access</span></span></code></pre></div><h3 id="_3-verify-access-control" tabindex="-1">3. Verify Access Control <a class="header-anchor" href="#_3-verify-access-control" aria-label="Permalink to &quot;3. Verify Access Control&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Try accessing a proxy you don&#39;t have access to</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Authorization: Bearer sk-test-123456&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     http://localhost:8999/some-endpoint</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Should return 403 Forbidden</span></span></code></pre></div><h2 id="custom-api-keys-troubleshooting" tabindex="-1">Custom API Keys Troubleshooting <a class="header-anchor" href="#custom-api-keys-troubleshooting" aria-label="Permalink to &quot;Custom API Keys Troubleshooting&quot;">​</a></h2><h3 id="issue-401-unauthorized-with-custom-token" tabindex="-1">Issue: 401 Unauthorized with custom token <a class="header-anchor" href="#issue-401-unauthorized-with-custom-token" aria-label="Permalink to &quot;Issue: 401 Unauthorized with custom token&quot;">​</a></h3><p><strong>Causes</strong>:</p><ol><li>Token hash doesn&#39;t match database</li><li>API key is revoked</li><li>API key has expired</li><li>User group is inactive</li></ol><p><strong>Solution</strong>:</p><ol><li>Verify the token is exactly correct (no extra spaces)</li><li>Check API key status in UI</li><li>Verify user group is active</li><li>Try creating a new API key</li></ol><h3 id="issue-works-with-curl-but-not-claude-code" tabindex="-1">Issue: Works with curl but not Claude Code <a class="header-anchor" href="#issue-works-with-curl-but-not-claude-code" aria-label="Permalink to &quot;Issue: Works with curl but not Claude Code&quot;">​</a></h3><p><strong>Causes</strong>:</p><ol><li>Claude Code may be modifying the Authorization header</li><li>Base URL not set correctly</li></ol><p><strong>Solution</strong>:</p><ol><li>Verify base URL: <code>http://localhost:8033/</code> (with trailing slash)</li><li>Test with curl first to confirm token works</li><li>Check Claude Code logs for actual headers sent</li></ol><h3 id="issue-token-shows-as-unknown-in-ui" tabindex="-1">Issue: Token shows as &quot;Unknown&quot; in UI <a class="header-anchor" href="#issue-token-shows-as-unknown-in-ui" aria-label="Permalink to &quot;Issue: Token shows as &quot;Unknown&quot; in UI&quot;">​</a></h3><p><strong>Cause</strong>: Non-standard token format</p><p><strong>Solution</strong>: This is expected for custom tokens. The UI will show:</p><ul><li><strong>Prefix</strong>: First 8 characters (e.g., <code>sk-test-</code>)</li><li><strong>Masked</strong>: <code>sk-test-••••••••</code></li></ul><h2 id="migration-guide" tabindex="-1">Migration Guide <a class="header-anchor" href="#migration-guide" aria-label="Permalink to &quot;Migration Guide&quot;">​</a></h2><h3 id="from-proxy-setup-to-direct" tabindex="-1">From Proxy Setup to Direct <a class="header-anchor" href="#from-proxy-setup-to-direct" aria-label="Permalink to &quot;From Proxy Setup to Direct&quot;">​</a></h3><p><strong>Before</strong> (with nginx/Python proxy):</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Stop the proxy</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pkill</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> claude-proxy.py</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># or</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">brew</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> services</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> stop</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Update environment</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ANTHROPIC_BASE_URL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">http://localhost:8033/  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Change port</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Create custom API key via UI or API</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Restart Claude Code - it will now work directly!</span></span></code></pre></div><p><strong>After</strong>:</p><ul><li>✅ No proxy process running</li><li>✅ Direct connection to gateway</li><li>✅ Same authentication experience</li><li>✅ Simpler troubleshooting</li></ul><h2 id="custom-keys-see-also" tabindex="-1">Custom Keys See Also <a class="header-anchor" href="#custom-keys-see-also" aria-label="Permalink to &quot;Custom Keys See Also&quot;">​</a></h2><ul><li><a href="./api-key-authentication.html">API Key Authentication Guide</a></li><li><a href="./../integration/claude-code-proxy-setup.html">Claude Code Proxy Setup</a> (now optional!)</li><li><a href="./../api-usage/unified-web-api.html#oauth-user-access-control-endpoints">User Groups Management</a> - See OAuth User Access Control section</li><li><a href="./../api-usage/unified-web-api.html">Unified Web API</a></li></ul>`,114)])])}const g=a(l,[["render",o]]);export{u as __pageData,g as default};
