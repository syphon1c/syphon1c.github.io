import{_ as t,o as i,c as a,ah as s}from"./chunks/framework.504LQ1l3.js";const n="/assets/claude-code-anthropic-provider-01.C5vFMVMh.png",g=JSON.parse('{"title":"Using Claude Code with AI Security Gateway","description":"","frontmatter":{},"headers":[],"relativePath":"integration/claude-code-proxy-setup.md","filePath":"integration/claude-code-proxy-setup.md"}'),o={name:"integration/claude-code-proxy-setup.md"};function r(l,e,h,u,c,d){return i(),a("div",null,[...e[0]||(e[0]=[s('<h1 id="using-claude-code-with-ai-security-gateway" tabindex="-1">Using Claude Code with AI Security Gateway <a class="header-anchor" href="#using-claude-code-with-ai-security-gateway" aria-label="Permalink to &quot;Using Claude Code with AI Security Gateway&quot;">​</a></h1><h2 id="overview" tabindex="-1">Overview <a class="header-anchor" href="#overview" aria-label="Permalink to &quot;Overview&quot;">​</a></h2><p>The AI Security Gateway now has built-in <strong>Provider Authentication</strong> that handles LLM provider credentials automatically. You no longer need to configure nginx proxies or custom header injection - the gateway manages provider authentication for you while your end users authenticate with the gateway using OAuth or API keys.</p><h2 id="quick-setup-recommended" tabindex="-1">Quick Setup (Recommended) <a class="header-anchor" href="#quick-setup-recommended" aria-label="Permalink to &quot;Quick Setup (Recommended)&quot;">​</a></h2><p>With the new Provider Authentication feature, setting up Claude Code takes just <strong>3 simple steps</strong>:</p><h3 id="step-1-configure-provider-authentication-in-the-web-ui" tabindex="-1">Step 1: Configure Provider Authentication in the Web UI <a class="header-anchor" href="#step-1-configure-provider-authentication-in-the-web-ui" aria-label="Permalink to &quot;Step 1: Configure Provider Authentication in the Web UI&quot;">​</a></h3><ol><li>Open the AI Security Gateway Web UI</li><li>Navigate to <strong>Proxies</strong> page</li><li>Create or edit an LLM proxy for Anthropic</li><li>In the <strong>Provider Authentication</strong> section: <ul><li><strong>Authentication Type</strong>: Select <code>API Key</code></li><li><strong>Provider</strong>: Select <code>Anthropic</code> from the dropdown</li><li><strong>API Key</strong>: Enter your Anthropic API key (e.g., <code>sk-ant-api03-...</code>)</li><li>Click <strong>Validate Authentication</strong> to test the connection</li><li>Click <strong>Save</strong> to store the configuration (credentials are encrypted at rest)</li></ul></li></ol><p><img src="'+n+`" alt="Provider Authentication Configuration"></p><p><strong>Available Authentication Types:</strong></p><ul><li><strong>API Key</strong>: For most providers (OpenAI, Anthropic, Cohere, etc.)</li><li><strong>Custom Headers</strong>: For providers with custom authentication headers</li><li><strong>AWS Bedrock</strong>: For AWS Bedrock with IAM credentials</li></ul><p><strong>Supported Providers:</strong></p><ul><li>Anthropic (Claude)</li><li>OpenAI (GPT models)</li><li>Azure OpenAI</li><li>AWS Bedrock (Anthropic, Amazon models)</li><li>Google Gemini</li><li>Cohere</li><li>Mistral AI</li><li>Perplexity AI</li><li>Together AI</li><li>Groq</li><li>OpenRouter</li><li>Fireworks AI</li></ul><h3 id="step-2-grant-user-access" tabindex="-1">Step 2: Grant User Access <a class="header-anchor" href="#step-2-grant-user-access" aria-label="Permalink to &quot;Step 2: Grant User Access&quot;">​</a></h3><p>Ensure your user or team is assigned access to the proxy:</p><ol><li>Navigate to <strong>User Groups</strong> in the Web UI</li><li>Find or create the user group for your API user</li><li>Assign the LLM proxy to the group</li><li>Generate an API key for the user (if not already done)</li></ol><h3 id="step-3-configure-claude-code-environment-variables" tabindex="-1">Step 3: Configure Claude Code Environment Variables <a class="header-anchor" href="#step-3-configure-claude-code-environment-variables" aria-label="Permalink to &quot;Step 3: Configure Claude Code Environment Variables&quot;">​</a></h3><p>Set these environment variables for Claude Code to use the gateway:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ANTHROPIC_BASE_URL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">http://ai-sec-gateway.local:8033/</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ANTHROPIC_AUTH_TOKEN</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;uag_kbx9abcdef1234567890...&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # Your AI Security Gateway API key</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ANTHROPIC_MODEL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;custom--us.anthropic.claude-sonnet-4-5-20250929-v1&quot;</span></span></code></pre></div><p>Replace:</p><ul><li><code>ai-sec-gateway.local:8033</code> with your gateway hostname and LLM proxy port</li><li><code>uag_kbx9...</code> with your AI Security Gateway API key</li><li>Model name with your desired Claude model</li></ul><p><strong>That&#39;s it!</strong> Claude Code will now:</p><ol><li>Send requests to the AI Security Gateway</li><li>Authenticate using your gateway API key (<code>X-API-Key</code> header)</li><li>Gateway automatically injects the provider API key (from Provider Authentication)</li><li>All traffic is monitored, logged, and protected by security policies</li></ol><hr><h2 id="how-it-works" tabindex="-1">How It Works <a class="header-anchor" href="#how-it-works" aria-label="Permalink to &quot;How It Works&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>┌─────────────────┐</span></span>
<span class="line"><span>│   Claude Code   │  export ANTHROPIC_BASE_URL=http://gateway:8033/</span></span>
<span class="line"><span>└────────┬────────┘  export ANTHROPIC_AUTH_TOKEN=&quot;uag_kbx9...&quot;</span></span>
<span class="line"><span>         │ Authorization: Bearer uag_kbx9...</span></span>
<span class="line"><span>         ↓</span></span>
<span class="line"><span>┌─────────────────┐</span></span>
<span class="line"><span>│ AI Security     │  1. Validates gateway API key (X-API-Key)</span></span>
<span class="line"><span>│ Gateway         │  2. Injects provider credentials (encrypted at rest)</span></span>
<span class="line"><span>│ (Port 8033)     │  3. Applies security policies</span></span>
<span class="line"><span>└────────┬────────┘  4. Logs request + response</span></span>
<span class="line"><span>         │ Authorization: Bearer sk-ant-api03-... (from Provider Auth)</span></span>
<span class="line"><span>         ↓</span></span>
<span class="line"><span>┌─────────────────┐</span></span>
<span class="line"><span>│ Anthropic API   │  Receives authenticated request</span></span>
<span class="line"><span>└─────────────────┘</span></span></code></pre></div><p><strong>Benefits:</strong></p><ul><li>✅ <strong>No nginx or proxy scripts needed</strong> - Provider Authentication handles credentials</li><li>✅ <strong>Encrypted credential storage</strong> - Provider keys encrypted at rest in the database</li><li>✅ <strong>Automatic credential injection</strong> - Gateway adds provider auth to every request</li><li>✅ <strong>User-level authentication</strong> - End users authenticate with gateway (OAuth/API keys)</li><li>✅ <strong>Centralized credential management</strong> - Update provider keys in one place</li><li>✅ <strong>Security monitoring</strong> - All requests logged and analyzed</li><li>✅ <strong>Policy enforcement</strong> - Apply security rules before reaching the provider</li></ul><h2 id="testing-the-setup" tabindex="-1">Testing the Setup <a class="header-anchor" href="#testing-the-setup" aria-label="Permalink to &quot;Testing the Setup&quot;">​</a></h2><p>Once you&#39;ve configured Provider Authentication and set the environment variables, test your setup:</p><h3 id="test-with-curl" tabindex="-1">Test with curl <a class="header-anchor" href="#test-with-curl" aria-label="Permalink to &quot;Test with curl&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -X</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> POST</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://ai-sec-gateway.local:8033/v1/messages</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;X-API-Key: uag_kbx9abcdef1234567890...&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Content-Type: application/json&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;model&quot;: &quot;custom--us.anthropic.claude-sonnet-4-5-20250929-v1&quot;,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;messages&quot;: [{&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;Hello, how are you?&quot;}],</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;max_tokens&quot;: 100</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  }&#39;</span></span></code></pre></div><p><strong>Expected result</strong>: <code>200 OK</code> with Claude&#39;s response. The gateway automatically injected the provider API key.</p><h3 id="test-with-claude-code" tabindex="-1">Test with Claude Code <a class="header-anchor" href="#test-with-claude-code" aria-label="Permalink to &quot;Test with Claude Code&quot;">​</a></h3><p>After setting the environment variables, start Claude Code and send a request. It should work seamlessly.</p><h3 id="check-gateway-logs" tabindex="-1">Check Gateway Logs <a class="header-anchor" href="#check-gateway-logs" aria-label="Permalink to &quot;Check Gateway Logs&quot;">​</a></h3><p>View the request logs in the Web UI:</p><ol><li>Navigate to <strong>Proxies</strong> page</li><li>Click the <strong>Logs</strong> button on your LLM proxy</li><li>You should see authenticated requests with your user/team information</li></ol><hr><h2 id="troubleshooting" tabindex="-1">Troubleshooting <a class="header-anchor" href="#troubleshooting" aria-label="Permalink to &quot;Troubleshooting&quot;">​</a></h2><h3 id="issue-401-unauthorized" tabindex="-1">Issue: 401 Unauthorized <a class="header-anchor" href="#issue-401-unauthorized" aria-label="Permalink to &quot;Issue: 401 Unauthorized&quot;">​</a></h3><p><strong>Cause</strong>: Gateway API key is missing or invalid</p><p><strong>Solution</strong>:</p><ol><li>Verify your <code>ANTHROPIC_AUTH_TOKEN</code> environment variable is set correctly</li><li>Check that the API key exists in <strong>User Groups</strong> → <strong>API Keys</strong></li><li>Ensure the user/team has access to the LLM proxy</li><li>Test the API key:<div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;X-API-Key: uag_kbx9...&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://ai-sec-gateway.local:8033/v1/models</span></span></code></pre></div></li></ol><h3 id="issue-403-forbidden" tabindex="-1">Issue: 403 Forbidden <a class="header-anchor" href="#issue-403-forbidden" aria-label="Permalink to &quot;Issue: 403 Forbidden&quot;">​</a></h3><p><strong>Cause</strong>: User doesn&#39;t have access to the proxy</p><p><strong>Solution</strong>:</p><ol><li>Navigate to <strong>User Groups</strong> in the Web UI</li><li>Find your user group</li><li>Assign the LLM proxy to the group</li></ol><h3 id="issue-provider-authentication-failed" tabindex="-1">Issue: Provider Authentication Failed <a class="header-anchor" href="#issue-provider-authentication-failed" aria-label="Permalink to &quot;Issue: Provider Authentication Failed&quot;">​</a></h3><p><strong>Cause</strong>: Provider API key is invalid or expired</p><p><strong>Solution</strong>:</p><ol><li>Go to <strong>Proxies</strong> → Edit your LLM proxy</li><li>In <strong>Provider Authentication</strong> section, click <strong>Validate Authentication</strong></li><li>If validation fails, update the provider API key</li><li>Save the configuration</li></ol><h3 id="issue-connection-refused" tabindex="-1">Issue: Connection Refused <a class="header-anchor" href="#issue-connection-refused" aria-label="Permalink to &quot;Issue: Connection Refused&quot;">​</a></h3><p><strong>Cause</strong>: Gateway proxy is not running</p><p><strong>Solution</strong>:</p><ol><li>Go to <strong>Proxies</strong> page</li><li>Check the status of your LLM proxy</li><li>Click <strong>Start</strong> if it&#39;s stopped</li><li>Verify the port is correct in <code>ANTHROPIC_BASE_URL</code></li></ol><hr><h2 id="advanced-configuration" tabindex="-1">Advanced Configuration <a class="header-anchor" href="#advanced-configuration" aria-label="Permalink to &quot;Advanced Configuration&quot;">​</a></h2><h3 id="custom-headers-authentication" tabindex="-1">Custom Headers Authentication <a class="header-anchor" href="#custom-headers-authentication" aria-label="Permalink to &quot;Custom Headers Authentication&quot;">​</a></h3><p>For providers with custom authentication headers:</p><ol><li><strong>Authentication Type</strong>: Select <code>Custom Headers</code></li><li>Add header name/value pairs (e.g., <code>X-Custom-Auth: token123</code>)</li><li>Click <strong>Validate Authentication</strong> to test</li><li>Save the configuration</li></ol><h3 id="aws-bedrock-authentication" tabindex="-1">AWS Bedrock Authentication <a class="header-anchor" href="#aws-bedrock-authentication" aria-label="Permalink to &quot;AWS Bedrock Authentication&quot;">​</a></h3><p>For AWS Bedrock with IAM credentials:</p><ol><li><strong>Authentication Type</strong>: Select <code>AWS Bedrock</code></li><li>Enter: <ul><li><strong>AWS Region</strong>: (e.g., <code>us-east-1</code>)</li><li><strong>AWS Access Key ID</strong>: Your AWS access key</li><li><strong>AWS Secret Access Key</strong>: Your AWS secret key</li></ul></li><li>Click <strong>Validate Authentication</strong> to test</li><li>Save the configuration</li></ol><hr><h2 id="why-use-provider-authentication" tabindex="-1">Why Use Provider Authentication? <a class="header-anchor" href="#why-use-provider-authentication" aria-label="Permalink to &quot;Why Use Provider Authentication?&quot;">​</a></h2><h3 id="security-benefits" tabindex="-1">Security Benefits <a class="header-anchor" href="#security-benefits" aria-label="Permalink to &quot;Security Benefits&quot;">​</a></h3><ul><li>✅ <strong>Centralized credential management</strong>: Update provider keys in one place</li><li>✅ <strong>Encrypted storage</strong>: Provider credentials encrypted at rest in the database</li><li>✅ <strong>Audit trail</strong>: All requests logged with user attribution</li><li>✅ <strong>Policy enforcement</strong>: Apply security rules before reaching the provider</li><li>✅ <strong>User-level access control</strong>: OAuth/API key authentication for end users</li><li>✅ <strong>No credential exposure</strong>: End users never see provider API keys</li></ul><h3 id="operational-benefits" tabindex="-1">Operational Benefits <a class="header-anchor" href="#operational-benefits" aria-label="Permalink to &quot;Operational Benefits&quot;">​</a></h3><ul><li>✅ <strong>No proxy scripts needed</strong>: Built-in provider authentication</li><li>✅ <strong>Simple setup</strong>: Just configure once in the Web UI</li><li>✅ <strong>Cost tracking</strong>: Monitor token usage per user/team</li><li>✅ <strong>Rate limiting</strong>: Control usage per user or globally</li><li>✅ <strong>Multi-provider support</strong>: Switch providers without changing client code</li></ul><hr><h2 id="see-also" tabindex="-1">See Also <a class="header-anchor" href="#see-also" aria-label="Permalink to &quot;See Also&quot;">​</a></h2><ul><li><a href="./../configuration/provider-authentication.html">Provider Authentication Guide</a></li><li><a href="./../configuration/api-key-authentication.html">API Key Authentication</a></li><li><a href="./../configuration/user-groups.html">User Groups &amp; Access Control</a></li><li><a href="./../api-usage/unified-web-api.html">Unified Web API Reference</a></li></ul>`,72)])])}const k=t(o,[["render",r]]);export{g as __pageData,k as default};
