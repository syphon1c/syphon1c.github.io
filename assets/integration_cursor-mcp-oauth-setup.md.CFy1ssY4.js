import{_ as i,o as a,c as t,ah as e}from"./chunks/framework.504LQ1l3.js";const n="/assets/mcp-server-oauth-01.B6U5U3jv.png",o="/assets/mcp-server-oauth-connect.HMk7TJ82.png",l="/assets/mcp-server-oauth-flow.CnTmWYcL.png",y=JSON.parse('{"title":"Setting Up OAuth Authentication for MCP Clients","description":"","frontmatter":{},"headers":[],"relativePath":"integration/cursor-mcp-oauth-setup.md","filePath":"integration/cursor-mcp-oauth-setup.md"}'),r={name:"integration/cursor-mcp-oauth-setup.md"};function p(h,s,u,d,c,k){return a(),t("div",null,[...s[0]||(s[0]=[e('<h1 id="setting-up-oauth-authentication-for-mcp-clients" tabindex="-1">Setting Up OAuth Authentication for MCP Clients <a class="header-anchor" href="#setting-up-oauth-authentication-for-mcp-clients" aria-label="Permalink to &quot;Setting Up OAuth Authentication for MCP Clients&quot;">​</a></h1><blockquote><p><strong>✅ Automatic OAuth with Dynamic Client Registration</strong><br> MCP clients (Cursor, Claude Desktop, etc.) automatically discover OAuth requirements and register themselves via <strong>Dynamic Client Registration (DCR)</strong>. No manual configuration needed!</p></blockquote><p>This guide explains how MCP clients automatically authenticate with OAuth-enabled MCP proxies through the AI Security Gateway.</p><p><img src="'+n+`" alt="Cursor MCP Access"></p><div class="info custom-block"><p class="custom-block-title">You can apply this same process to most MCP clients that support RFC 8414!</p></div><h2 id="supported-mcp-clients-overview" tabindex="-1">Supported MCP Clients Overview <a class="header-anchor" href="#supported-mcp-clients-overview" aria-label="Permalink to &quot;Supported MCP Clients Overview&quot;">​</a></h2><table tabindex="0"><thead><tr><th>Client</th><th>RFC 8414 Support</th><th>DCR Support</th><th>Status</th></tr></thead><tbody><tr><td>Cursor IDE</td><td>✅ Yes</td><td>✅ Yes</td><td>Fully Supported</td></tr><tr><td>Claude Desktop</td><td>✅ Yes</td><td>✅ Yes</td><td>Fully Supported</td></tr><tr><td>VS Code + Copilot</td><td>✅ Yes</td><td>✅ Yes</td><td>Fully Supported</td></tr><tr><td>Custom MCP Clients</td><td>✅ Yes</td><td>✅ Yes</td><td>RFC-compliant</td></tr></tbody></table><p>The AI Security Gateway&#39;s <strong>OAuth Proxy</strong> feature supports two modes:</p><ul><li><strong>Upstream Mode</strong>: Gateway forwards client tokens directly to upstream OAuth providers</li><li><strong>Gateway Mode</strong>: Gateway acts as OAuth server and manages tokens for clients</li></ul><p>Both modes support <strong>Dynamic Client Registration (RFC 7591)</strong>, enabling Cursor to automatically:</p><ol><li>Discover OAuth requirements</li><li>Register itself as an OAuth client</li><li>Complete the OAuth flow</li><li>Authenticate all requests</li></ol><h2 id="quick-start-automatic-setup" tabindex="-1">Quick Start (Automatic Setup) <a class="header-anchor" href="#quick-start-automatic-setup" aria-label="Permalink to &quot;Quick Start (Automatic Setup)&quot;">​</a></h2><h3 id="cursor-ide-prerequisites" tabindex="-1">Cursor IDE Prerequisites <a class="header-anchor" href="#cursor-ide-prerequisites" aria-label="Permalink to &quot;Cursor IDE Prerequisites&quot;">​</a></h3><ul><li>✅ MCP proxy configured with OAuth Proxy enabled</li><li>✅ Gateway running and accessible</li><li>✅ Cursor IDE with MCP support</li></ul><h3 id="setup-steps" tabindex="-1">Setup Steps <a class="header-anchor" href="#setup-steps" aria-label="Permalink to &quot;Setup Steps&quot;">​</a></h3><ol><li><p><strong>Configure Cursor MCP</strong>: Update your <code>~/.cursor/mcp.json</code> file:</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;mcpServers&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;my-server&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;url&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;http://localhost:9050/mcp&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div></li><li><p><strong>Restart Cursor</strong>: After updating <code>mcp.json</code>, restart Cursor. (Not always a requirement)</p></li><li><p><strong>Authenticate Automatically</strong>:</p><ul><li>Cursor automatically detects OAuth is required (via <code>/.well-known/oauth-protected-resource</code>)</li><li>Cursor registers itself via Dynamic Client Registration (<code>/api/v1/oauth-proxy/{id}/register</code>)</li><li>Cursor displays &quot;Connect&quot; button in the UI (Needs Authentication) <img src="`+o+'" alt="Cursor MCP Auth"></li><li>Click &quot;Connect&quot; to complete OAuth flow in browser</li><li>Click &quot;Needs authentication&quot; is the connect button does not work <img src="'+l+`" alt="Cursor MCP Flow"></li><li>Cursor automatically receives and stores authentication token</li></ul></li></ol><p><strong>That&#39;s it!</strong> No manual token configuration needed.</p><h2 id="cursor-ide-how-it-works" tabindex="-1">Cursor IDE How It Works <a class="header-anchor" href="#cursor-ide-how-it-works" aria-label="Permalink to &quot;Cursor IDE How It Works&quot;">​</a></h2><h3 id="discovery-phase" tabindex="-1">Discovery Phase <a class="header-anchor" href="#discovery-phase" aria-label="Permalink to &quot;Discovery Phase&quot;">​</a></h3><ol><li><strong>OAuth Detection</strong>: Cursor queries <code>/.well-known/oauth-protected-resource</code> on the proxy</li><li><strong>Metadata Retrieval</strong>: Cursor queries <code>/.well-known/oauth-authorization-server</code> for OAuth endpoints</li><li><strong>Client Registration</strong>: Cursor POSTs to <code>/api/v1/oauth-proxy/{id}/register</code> (DCR) <ul><li>Gateway generates <code>client_id</code> and <code>client_secret</code></li><li>Cursor stores credentials locally</li></ul></li></ol><h3 id="authorization-phase" tabindex="-1">Authorization Phase <a class="header-anchor" href="#authorization-phase" aria-label="Permalink to &quot;Authorization Phase&quot;">​</a></h3><ol start="4"><li><strong>PKCE Generation</strong>: Cursor generates PKCE code verifier and challenge</li><li><strong>Authorization Request</strong>: Cursor opens browser to <code>/api/v1/oauth-proxy/{id}/authorize</code></li><li><strong>User Authentication</strong>: User completes OAuth flow with upstream provider</li><li><strong>Token Exchange</strong>: Cursor exchanges authorization code for access token</li><li><strong>Authenticated Access</strong>: Cursor uses token for all MCP requests</li></ol><h3 id="mode-specific-behavior" tabindex="-1">Mode-Specific Behavior <a class="header-anchor" href="#mode-specific-behavior" aria-label="Permalink to &quot;Mode-Specific Behavior&quot;">​</a></h3><p><strong>Upstream Mode</strong>:</p><ul><li>Cursor receives tokens directly from upstream provider (via Gateway proxy)</li><li>Tokens are provider-issued (e.g., Google access tokens)</li><li>Gateway forwards requests without modifying tokens</li></ul><p><strong>Gateway Mode</strong>:</p><ul><li>Cursor receives JWT access tokens issued by Gateway</li><li>Gateway stores upstream provider tokens securely</li><li>Gateway automatically injects upstream tokens when proxying to MCP server</li></ul><p>For technical details, see <a href="./../../technical/development/oauth-proxy-architecture.html">OAuth Proxy Architecture</a>.</p><h2 id="manual-configuration-fallback" tabindex="-1">Manual Configuration (Fallback) <a class="header-anchor" href="#manual-configuration-fallback" aria-label="Permalink to &quot;Manual Configuration (Fallback)&quot;">​</a></h2><p>If automatic discovery doesn&#39;t work, you can manually configure OAuth.</p><h3 id="option-1-use-api-key" tabindex="-1">Option 1: Use API Key <a class="header-anchor" href="#option-1-use-api-key" aria-label="Permalink to &quot;Option 1: Use API Key&quot;">​</a></h3><p>For machine access or automation:</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;mcpServers&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;my-server&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;url&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;http://localhost:9050/mcp&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;headers&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;X-API-Key&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;YOUR_API_KEY&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>API keys can be created in the Gateway Admin UI under <strong>API Keys</strong> section.</p><h2 id="cursor-configuration-examples" tabindex="-1">Cursor Configuration Examples <a class="header-anchor" href="#cursor-configuration-examples" aria-label="Permalink to &quot;Cursor Configuration Examples&quot;">​</a></h2><h3 id="example-1-development-with-upstream-mode" tabindex="-1">Example 1: Development with Upstream Mode <a class="header-anchor" href="#example-1-development-with-upstream-mode" aria-label="Permalink to &quot;Example 1: Development with Upstream Mode&quot;">​</a></h3><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;mcpServers&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;dev-server&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;url&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;http://localhost:9050/mcp&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;transport&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sse&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>Proxy Configuration</strong>:</p><ul><li><code>oauth_proxy_enabled: true</code></li><li><code>oauth_proxy_mode: &quot;upstream&quot;</code></li><li><code>oauth_proxy_provider_id: 1</code> (e.g., Google OAuth)</li></ul><p><strong>Behavior</strong>:</p><ul><li>Cursor auto-discovers OAuth requirements</li><li>Cursor registers via DCR</li><li>Cursor receives tokens from Google (via Gateway)</li><li>Fast, direct token exchange</li></ul><h3 id="example-2-production-with-gateway-mode" tabindex="-1">Example 2: Production with Gateway Mode <a class="header-anchor" href="#example-2-production-with-gateway-mode" aria-label="Permalink to &quot;Example 2: Production with Gateway Mode&quot;">​</a></h3><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;mcpServers&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;prod-server&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;url&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;https://gateway.example.com/mcp&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;transport&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sse&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>Proxy Configuration</strong>:</p><ul><li><code>oauth_proxy_enabled: true</code></li><li><code>oauth_proxy_mode: &quot;gateway&quot;</code></li><li><code>oauth_proxy_provider_id: 2</code> (e.g., Azure AD)</li><li><code>oauth_proxy_require_consent: true</code></li></ul><p><strong>Behavior</strong>:</p><ul><li>Cursor auto-discovers OAuth requirements</li><li>Cursor registers via DCR</li><li>User approves consent screen</li><li>Cursor receives JWT from Gateway</li><li>Gateway manages Azure AD tokens automatically</li></ul><h2 id="cursor-ide-troubleshooting" tabindex="-1">Cursor IDE Troubleshooting <a class="header-anchor" href="#cursor-ide-troubleshooting" aria-label="Permalink to &quot;Cursor IDE Troubleshooting&quot;">​</a></h2><h3 id="automatic-discovery-not-working" tabindex="-1">Automatic Discovery Not Working <a class="header-anchor" href="#automatic-discovery-not-working" aria-label="Permalink to &quot;Automatic Discovery Not Working&quot;">​</a></h3><p>If Cursor doesn&#39;t show the &quot;Connect&quot; button:</p><ol><li><p><strong>Verify Well-Known Endpoints</strong>:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Should return OAuth metadata</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost:9050/.well-known/oauth-protected-resource</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> jq</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Should include authorization_endpoint, token_endpoint, registration_endpoint</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost:9050/.well-known/oauth-authorization-server</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> jq</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .</span></span></code></pre></div></li><li><p><strong>Verify OAuth Proxy Configuration</strong>:</p><ul><li>Check proxy has <code>oauth_proxy_enabled: true</code></li><li>Check <code>oauth_proxy_provider_id</code> is set to valid provider</li><li>Check <code>oauth_proxy_mode</code> is set to &quot;upstream&quot; or &quot;gateway&quot;</li><li>Restart proxy after configuration changes</li></ul></li><li><p><strong>Check Gateway Logs</strong>:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tail</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> logs/unified-admin.log</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;oauth-proxy&quot;</span></span></code></pre></div><p>Look for DCR registration requests and authorization attempts.</p></li><li><p><strong>Test DCR Manually</strong>:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -X</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> POST</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost:8080/api/v1/oauth-proxy/9/register</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Content-Type: application/json&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;redirect_uris&quot;: [&quot;http://localhost:8888/callback&quot;],</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;client_name&quot;: &quot;Test Client&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  }&#39;</span></span></code></pre></div><p>Should return <code>client_id</code> and <code>client_secret</code>.</p></li></ol><h3 id="loading-tools-hangs-forever" tabindex="-1">Loading Tools Hangs Forever <a class="header-anchor" href="#loading-tools-hangs-forever" aria-label="Permalink to &quot;Loading Tools Hangs Forever&quot;">​</a></h3><p>If Cursor shows &quot;Loading tools&quot; indefinitely:</p><ol><li><p><strong>Check Token Validity</strong>:</p><ul><li>In Gateway mode: Verify JWT token is not expired</li><li>In Upstream mode: Verify provider token is not expired</li></ul></li><li><p><strong>Check Hybrid Authentication</strong>:</p><ul><li>Gateway should bypass its own auth when OAuth Proxy is enabled</li><li>Check logs for &quot;HybridProxyAuth: Using OAuth Proxy token validator&quot;</li></ul></li><li><p><strong>Verify Proxy is Running</strong>:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost:9050/health</span></span></code></pre></div></li></ol><h3 id="_401-unauthorized-errors" tabindex="-1">401 Unauthorized Errors <a class="header-anchor" href="#_401-unauthorized-errors" aria-label="Permalink to &quot;401 Unauthorized Errors&quot;">​</a></h3><p><strong>Symptom</strong>: Requests return 401 even with valid token.</p><p><strong>Solutions</strong>:</p><ol><li><p><strong>Check Token Format</strong>:</p><ul><li>Should be: <code>Authorization: Bearer &lt;token&gt;</code></li><li>No extra spaces or newlines</li></ul></li><li><p><strong>Verify Token Type</strong>:</p><ul><li>Gateway mode: Use JWT token from <code>/api/v1/oauth-proxy/{id}/token</code></li><li>Upstream mode: Use provider-issued token</li><li>Session tokens: Use tokens from Gateway session</li></ul></li><li><p><strong>Check Token Validator</strong>:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Check Gateway logs for token validation</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;OAuth Proxy token validation&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> logs/unified-admin.log</span></span></code></pre></div></li></ol><h3 id="oauth-flow-fails" tabindex="-1">OAuth Flow Fails <a class="header-anchor" href="#oauth-flow-fails" aria-label="Permalink to &quot;OAuth Flow Fails&quot;">​</a></h3><p><strong>Symptom</strong>: Browser redirect fails or shows error page.</p><p><strong>Solutions</strong>:</p><ol><li><p><strong>Check Redirect URIs</strong>:</p><ul><li>Cursor&#39;s redirect URI must match registered URI patterns</li><li>Common patterns: <code>cursor://*/oauth/*/callback</code></li><li>Check proxy config: <code>oauth_proxy_allowed_redirect_uris</code></li></ul></li><li><p><strong>Check PKCE Validation</strong>:</p><ul><li>In Gateway mode, both PKCE flows must succeed</li><li>Check logs for &quot;Invalid code verifier&quot; errors</li><li>Ensure client sends correct <code>code_verifier</code> in token request</li></ul></li><li><p><strong>Check Provider Configuration</strong>:</p><ul><li>Verify OAuth provider credentials are correct</li><li>Verify provider&#39;s redirect URI includes Gateway callback</li><li>Example: <code>http://localhost:8080/api/v1/oauth/callback</code></li></ul></li></ol><h3 id="connection-refused" tabindex="-1">Connection Refused <a class="header-anchor" href="#connection-refused" aria-label="Permalink to &quot;Connection Refused&quot;">​</a></h3><p><strong>Symptom</strong>: Cannot connect to proxy or Gateway.</p><p><strong>Solutions</strong>:</p><ol><li><p><strong>Verify Services are Running</strong>:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Check Gateway</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost:8080/api/v1/health</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Check Proxy</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost:9050/health</span></span></code></pre></div></li><li><p><strong>Check Port Configuration</strong>:</p><ul><li>Gateway default: <code>8080</code></li><li>Proxy default: <code>9050</code> (or configured port)</li><li>Verify firewall allows connections</li></ul></li><li><p><strong>Check Network Settings</strong>:</p><ul><li>For remote Gateway: Ensure it&#39;s accessible from client machine</li><li>For localhost: Verify <code>127.0.0.1</code> vs <code>localhost</code> resolution</li></ul></li></ol><h3 id="tokens-expire-too-quickly" tabindex="-1">Tokens Expire Too Quickly <a class="header-anchor" href="#tokens-expire-too-quickly" aria-label="Permalink to &quot;Tokens Expire Too Quickly&quot;">​</a></h3><p><strong>Gateway Mode</strong>:</p><ul><li>JWT tokens expire based on upstream provider&#39;s token lifetime</li><li>Default: 1 hour (3600 seconds)</li><li>Gateway automatically refreshes if refresh token available</li></ul><p><strong>Upstream Mode</strong>:</p><ul><li>Client receives provider tokens directly</li><li>Client responsible for token refresh</li></ul><h2 id="cursor-ide-advanced-configuration" tabindex="-1">Cursor IDE Advanced Configuration <a class="header-anchor" href="#cursor-ide-advanced-configuration" aria-label="Permalink to &quot;Cursor IDE Advanced Configuration&quot;">​</a></h2><h3 id="custom-redirect-uri-patterns" tabindex="-1">Custom Redirect URI Patterns <a class="header-anchor" href="#custom-redirect-uri-patterns" aria-label="Permalink to &quot;Custom Redirect URI Patterns&quot;">​</a></h3><p>Configure allowed redirect URI patterns in proxy settings:</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;oauth_proxy_allowed_redirect_uris&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;cursor://*/oauth/*/callback&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;http://localhost:*/callback&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;vscode://*/oauth/callback&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="consent-screen-customization" tabindex="-1">Consent Screen Customization <a class="header-anchor" href="#consent-screen-customization" aria-label="Permalink to &quot;Consent Screen Customization&quot;">​</a></h3><p>Enable/disable consent screen per proxy:</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;oauth_proxy_require_consent&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>When enabled, users must approve each OAuth flow, providing:</p><ul><li>Requested scopes visibility</li><li>Client application details</li><li>Option to deny access</li></ul><h3 id="cursor-ide-rate-limiting" tabindex="-1">Cursor IDE Rate Limiting <a class="header-anchor" href="#cursor-ide-rate-limiting" aria-label="Permalink to &quot;Cursor IDE Rate Limiting&quot;">​</a></h3><p>DCR and token endpoints are rate-limited by default:</p><ul><li><strong>60 requests per minute</strong> per IP address</li><li>Returns <code>429 Too Many Requests</code> when exceeded</li><li><code>Retry-After</code> header indicates wait time</li></ul><hr><h2 id="claude-desktop-configuration" tabindex="-1">Claude Desktop Configuration <a class="header-anchor" href="#claude-desktop-configuration" aria-label="Permalink to &quot;Claude Desktop Configuration&quot;">​</a></h2><p>Claude Desktop follows the same OAuth discovery and DCR process as Cursor.</p><h3 id="claude-desktop-configuration-file" tabindex="-1">Claude Desktop Configuration File <a class="header-anchor" href="#claude-desktop-configuration-file" aria-label="Permalink to &quot;Claude Desktop Configuration File&quot;">​</a></h3><p><strong>macOS</strong>: <code>~/Library/Application Support/Claude/claude_desktop_config.json</code><br><strong>Windows</strong>: <code>%APPDATA%\\Claude\\claude_desktop_config.json</code></p><h3 id="example-1-basic-oauth-configuration" tabindex="-1">Example 1: Basic OAuth Configuration <a class="header-anchor" href="#example-1-basic-oauth-configuration" aria-label="Permalink to &quot;Example 1: Basic OAuth Configuration&quot;">​</a></h3><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;mcpServers&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;secure-mcp&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;url&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;http://localhost:9050/mcp&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>After saving the config, restart Claude Desktop. It will:</p><ol><li>Auto-discover OAuth requirements via <code>/.well-known/oauth-protected-resource</code></li><li>Register via DCR at <code>/api/v1/oauth-proxy/{id}/register</code></li><li>Display &quot;Connect&quot; or &quot;Authenticate&quot; prompt</li><li>Complete OAuth flow in browser</li></ol><h3 id="example-2-production-configuration" tabindex="-1">Example 2: Production Configuration <a class="header-anchor" href="#example-2-production-configuration" aria-label="Permalink to &quot;Example 2: Production Configuration&quot;">​</a></h3><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;mcpServers&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;production-mcp&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;url&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;https://mcp.company.com:9050/mcp&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;transport&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sse&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="example-3-using-api-key-non-oauth" tabindex="-1">Example 3: Using API Key (Non-OAuth) <a class="header-anchor" href="#example-3-using-api-key-non-oauth" aria-label="Permalink to &quot;Example 3: Using API Key (Non-OAuth)&quot;">​</a></h3><p>For machine access where interactive OAuth isn&#39;t suitable:</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;mcpServers&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;machine-access&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;url&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;http://localhost:9050/mcp&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;headers&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;X-API-Key&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;uag_your_api_key_here&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><hr><h2 id="support" tabindex="-1">Support <a class="header-anchor" href="#support" aria-label="Permalink to &quot;Support&quot;">​</a></h2><p>For issues or questions:</p><ol><li>Check Gateway logs: <code>tail -f logs/unified-admin.log</code></li><li>Enable debug logging: Set <code>LOG_LEVEL=debug</code> environment variable</li><li>Test endpoints manually using curl examples above</li><li>Review related documentation for detailed troubleshooting</li></ol><hr><h2 id="summary" tabindex="-1">Summary <a class="header-anchor" href="#summary" aria-label="Permalink to &quot;Summary&quot;">​</a></h2><p>✅ <strong>Automatic OAuth with DCR</strong> - No manual configuration needed<br> ✅ <strong>Dual Mode Support</strong> - Choose Upstream or Gateway mode<br> ✅ <strong>PKCE Security</strong> - RFC 7636 compliant<br> ✅ <strong>Multi-Provider</strong> - Google, GitHub, Azure AD, Okta, etc.<br> ✅ <strong>Hybrid Authentication</strong> - OAuth tokens AND API keys work together<br> ✅ <strong>Multi-Client Support</strong> - Cursor, Claude Desktop, VS Code, custom clients</p><p>The OAuth Proxy with Dynamic Client Registration provides zero-configuration OAuth authentication for MCP clients, with flexible deployment options for both development and production environments.</p>`,105)])])}const E=i(r,[["render",p]]);export{y as __pageData,E as default};
